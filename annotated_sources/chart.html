<!DOCTYPE html>

<html>
<head>
  <title>chart.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="base_renderer.html">
                base_renderer.coffee
              </a>
            
              
              <a class="source" href="draggable_renderer.html">
                draggable_renderer.coffee
              </a>
            
              
              <a class="source" href="series.html">
                series.coffee
              </a>
            
              
              <a class="source" href="series_set.html">
                series_set.coffee
              </a>
            
              
              <a class="source" href="tooltip.html">
                tooltip.coffee
              </a>
            
              
              <a class="source" href="utils.html">
                utils.coffee
              </a>
            
              
              <a class="source" href="index.html">
                index.coffee
              </a>
            
              
              <a class="source" href="area_renderer.html">
                area_renderer.coffee
              </a>
            
              
              <a class="source" href="axis_base.html">
                axis_base.coffee
              </a>
            
              
              <a class="source" href="axis_linear.html">
                axis_linear.coffee
              </a>
            
              
              <a class="source" href="axis_time.html">
                axis_time.coffee
              </a>
            
              
              <a class="source" href="bullet_renderer.html">
                bullet_renderer.coffee
              </a>
            
              
              <a class="source" href="chart.html">
                chart.coffee
              </a>
            
              
              <a class="source" href="column_renderer.html">
                column_renderer.coffee
              </a>
            
              
              <a class="source" href="donut_renderer.html">
                donut_renderer.coffee
              </a>
            
              
              <a class="source" href="dragger.html">
                dragger.coffee
              </a>
            
              
              <a class="source" href="fixtures_time.html">
                fixtures_time.coffee
              </a>
            
              
              <a class="source" href="gauge_renderer.html">
                gauge_renderer.coffee
              </a>
            
              
              <a class="source" href="grid.html">
                grid.coffee
              </a>
            
              
              <a class="source" href="leaderboard_renderer.html">
                leaderboard_renderer.coffee
              </a>
            
              
              <a class="source" href="line_renderer.html">
                line_renderer.coffee
              </a>
            
              
              <a class="source" href="range_slider.html">
                range_slider.coffee
              </a>
            
              
              <a class="source" href="scatter_renderer.html">
                scatter_renderer.coffee
              </a>
            
              
              <a class="source" href="waterfall_renderer.html">
                waterfall_renderer.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>chart.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="class"><span class="keyword">class</span> <span class="title">Tactile</span>.<span class="title">Chart</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Hash to map renderer name to class name. Used in looking up series type</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="attribute">_renderers</span>:
    <span class="string">'gauge'</span>: Tactile.GaugeRenderer
    <span class="string">'column'</span>: Tactile.ColumnRenderer
    <span class="string">'line'</span>: Tactile.LineRenderer
    <span class="string">'area'</span>: Tactile.AreaRenderer
    <span class="string">'scatter'</span>: Tactile.ScatterRenderer
    <span class="string">'donut'</span>: Tactile.DonutRenderer
    <span class="string">'waterfall'</span>: Tactile.WaterfallRenderer
    <span class="string">'leaderboard'</span>: Tactile.LeaderboardRenderer
    <span class="string">'bullet'</span>: Tactile.BulletRenderer</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>default values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="attribute">defaultPadding</span>: {<span class="attribute">top</span>: <span class="number">0</span>, <span class="attribute">right</span>: <span class="number">0</span>, <span class="attribute">bottom</span>: <span class="number">0</span>, <span class="attribute">left</span>: <span class="number">0</span>}
  <span class="attribute">defaultAxisPadding</span>: {<span class="attribute">top</span>: <span class="number">0</span>, <span class="attribute">right</span>: <span class="number">0</span>, <span class="attribute">bottom</span>: <span class="number">0</span>, <span class="attribute">left</span>: <span class="number">0</span>}
  <span class="attribute">prevAxisPadding</span>: {<span class="attribute">top</span>: <span class="number">0</span>, <span class="attribute">right</span>: <span class="number">0</span>, <span class="attribute">bottom</span>: <span class="number">0</span>, <span class="attribute">left</span>: <span class="number">0</span>}
  <span class="attribute">interpolation</span>: <span class="string">'monotone'</span>
  <span class="attribute">offset</span>: <span class="string">'zero'</span>
  <span class="attribute">min</span>: <span class="literal">undefined</span>
  <span class="attribute">max</span>: <span class="literal">undefined</span>
  <span class="attribute">transitionSpeed</span>: <span class="number">500</span>
  <span class="attribute">defaultHeight</span>: <span class="number">400</span>
  <span class="attribute">defaultWidth</span>: <span class="number">680</span>
  <span class="attribute">defaultAxesOptions</span>:
    <span class="attribute">x</span>:
      <span class="attribute">dimension</span>: <span class="string">"time"</span>
      <span class="attribute">showZeroLine</span>: <span class="literal">false</span>
    <span class="attribute">y</span>:
      <span class="attribute">dimension</span>: <span class="string">"linear"</span>
      <span class="attribute">showZeroLine</span>: <span class="literal">true</span>
    <span class="attribute">y1</span>:
      <span class="attribute">dimension</span>: <span class="string">"linear"</span>
      <span class="attribute">showZeroLine</span>: <span class="literal">true</span>

  <span class="attribute">defaultMinXFrame</span>:  <span class="number">1</span>
  <span class="attribute">defaultMinYFrame</span>:  <span class="number">1</span>
  <span class="attribute">defaultMinY1Frame</span>: <span class="number">1</span>
  <span class="attribute">defaultMaxXFrame</span>: Infinity
  <span class="attribute">defaultMaxYFrame</span>: Infinity
  <span class="attribute">defaultMaxY1Frame</span>: Infinity

  <span class="attribute">_autoSetAvailableXFrame</span>: <span class="literal">false</span>
  <span class="attribute">_autoSetAvailableYFrame</span>: <span class="literal">false</span>
  <span class="attribute">_autoSetAvailableY1Frame</span>: <span class="literal">false</span>

  <span class="attribute">_lastYTranslate</span>: <span class="number">0</span>

  <span class="attribute">aggregated</span>:
    <span class="attribute">column</span>: <span class="literal">false</span>
    <span class="attribute">line</span>: <span class="literal">false</span>
    <span class="attribute">waterfall</span>: <span class="literal">false</span>

  <span class="attribute">animateShowHide</span>: <span class="literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>builds the chart object using any passed arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="attribute">constructor</span>: <span class="function"><span class="params">(args = {})</span> -&gt;</span>
    <span class="property">@utils</span> = <span class="keyword">new</span> Tactile.Utils()
    <span class="property">@padding</span> = _.defaults {}, args.padding, <span class="property">@defaultPadding</span>
    <span class="property">@axisPadding</span> = _.defaults {}, args.axisPadding, <span class="property">@defaultAxisPadding</span>

    <span class="property">@renderers</span> = []
    <span class="property">@renderers_to_delete</span> = []
    <span class="property">@axesList</span> = {}
    <span class="property">@newAxes</span> = <span class="literal">undefined</span>
    <span class="property">@gridList</span> = {}
    <span class="property">@series</span> = <span class="keyword">new</span> Tactile.SeriesSet([], @)
    <span class="property">@window</span> = {}
    <span class="property">@updateCallbacks</span> = []
    <span class="property">@manipulateCallbacks</span> = []
    <span class="property">@elementChangeCallbacks</span> = []
    <span class="property">@timesRendered</span> = <span class="number">0</span>

    <span class="property">@_setupDomainAndRange</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>chart size is handled with its own method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@setSize</span>
      <span class="attribute">width</span>: args.width <span class="keyword">or</span> <span class="property">@defaultWidth</span>
      <span class="attribute">height</span>: args.height <span class="keyword">or</span> <span class="property">@defaultHeight</span>
    <span class="keyword">delete</span> args.width <span class="keyword">if</span> args.width?
    <span class="keyword">delete</span> args.height <span class="keyword">if</span> args.height?</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>add series if passed in the constructor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@addSeries</span>(args.series, <span class="attribute">overwrite</span>: <span class="literal">true</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>set autoscale to true by default</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> _.isUndefined(args.autoScale) <span class="keyword">then</span> <span class="property">@setAutoScale</span>(<span class="literal">true</span>) <span class="keyword">else</span> <span class="property">@setAutoScale</span>(args.autoScale)

    <span class="property">@setMinXFrame</span> args.minXFrame <span class="keyword">or</span> <span class="property">@defaultMinXFrame</span>
    <span class="property">@setMinYFrame</span> args.minYFrame <span class="keyword">or</span> <span class="property">@defaultMinYFrame</span>
    <span class="property">@setMinY1Frame</span> args.minY1Frame <span class="keyword">or</span> <span class="property">@defaultMinY1Frame</span>
    <span class="property">@setMaxXFrame</span> args.maxXFrame <span class="keyword">or</span> <span class="property">@defaultMaxXFrame</span>
    <span class="property">@setMaxYFrame</span> args.maxYFrame <span class="keyword">or</span> <span class="property">@defaultMaxYFrame</span>
    <span class="property">@setMaxY1Frame</span> args.maxY1Frame <span class="keyword">or</span> <span class="property">@defaultMaxY1Frame</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Adds series to the chart and creates renderer instance for it
Note: you may pass a single object here or an array of them
Note: pass option &#39;overwrite: true&#39; to remove all previous series</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="attribute">addSeries</span>: <span class="function"><span class="params">(series, options = {overwrite: <span class="literal">false</span>})</span> -&gt;</span>
    <span class="keyword">return</span> <span class="keyword">unless</span> series
    _.each <span class="property">@aggregated</span>, <span class="function"><span class="params">(value, key)</span> =&gt;</span>
      <span class="property">@aggregated</span>[key] = <span class="literal">false</span>
    series = [series] <span class="keyword">unless</span> _.isArray(series)

    newSeries = _.map<span class="function"><span class="params">(series, (options) -&gt; <span class="keyword">new</span> Tactile.Series(options))</span>
    @<span class="title">series</span>.<span class="title">add</span><span class="params">(newSeries, options.overwrite)</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>only init the renderers for just added series
TODO: Refactor this into series/renderer constructor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@initRenderers</span>(newSeries)

    <span class="keyword">if</span> options.overwrite
      <span class="property">@animateShowHide</span> = <span class="literal">true</span>
    <span class="keyword">else</span>
      <span class="property">@animateShowHide</span> = <span class="literal">false</span>
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>TODO: move next 9 methods away to a separate class. Zoomable or sth.</p>
<h1 id="-">#</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre>    setAvailable[X|Y|Y1]Frame
      min <span class="keyword">and</span> max values that can be zoomed <span class="keyword">or</span> moved to.
      Computed <span class="keyword">if</span> <span class="keyword">not</span> given</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h1 id="-">#</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="attribute">setAvailableXFrame</span>: <span class="function"><span class="params">(availableXFrame)</span> =&gt;</span>
    <span class="property">@availableXFrame</span> = availableXFrame <span class="keyword">or</span> <span class="property">@defaultAvailableXFrame</span>
    @

  <span class="attribute">setAvailableYFrame</span>: <span class="function"><span class="params">(availableYFrame)</span> =&gt;</span>
    <span class="property">@availableYFrame</span> = availableYFrame <span class="keyword">or</span> <span class="property">@defaultAvailableYFrame</span>
    @

  <span class="attribute">setAvailableY1Frame</span>: <span class="function"><span class="params">(availableY1Frame)</span> =&gt;</span>
    <span class="property">@availableY1Frame</span> = availableY1Frame <span class="keyword">or</span> <span class="property">@defaultAvailableY1Frame</span>
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h1 id="-">#</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre>    setMin[X|Y|Y1]Frame
      <span class="keyword">this</span> <span class="keyword">is</span> the minimum distance between points to which you can zoom in.
      <span class="number">1</span> <span class="keyword">by</span> <span class="reserved">default</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h1 id="-">#</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="attribute">setMinXFrame</span>: <span class="function"><span class="params">(minXFrame)</span> =&gt;</span>
    <span class="property">@minXFrame</span> = minXFrame <span class="keyword">or</span> <span class="property">@defaultMinXFrame</span>
    @

  <span class="attribute">setMinYFrame</span>: <span class="function"><span class="params">(minYFrame)</span> =&gt;</span>
    <span class="property">@minYFrame</span> = minYFrame <span class="keyword">or</span> <span class="property">@defaultMinYFrame</span>
    @

  <span class="attribute">setMinY1Frame</span>: <span class="function"><span class="params">(minY1Frame)</span> =&gt;</span>
    <span class="property">@minY1Frame</span> = minY1Frame <span class="keyword">or</span> <span class="property">@defaultMinY1Frame</span>
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h1 id="-">#</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre>    setMax[X|Y|Y1]Frame
    <span class="keyword">this</span> <span class="keyword">is</span> the maximum distance between points to which you can zoom out.
    Infinity <span class="keyword">by</span> <span class="reserved">default</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h1 id="-">#</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="attribute">setMaxXFrame</span>: <span class="function"><span class="params">(maxXFrame)</span> =&gt;</span>
    <span class="property">@maxXFrame</span> = maxXFrame <span class="keyword">or</span> <span class="property">@defaultMaxXFrame</span>
    @

  <span class="attribute">setMaxYFrame</span>: <span class="function"><span class="params">(maxYFrame)</span> =&gt;</span>
    <span class="property">@maxYFrame</span> = maxYFrame <span class="keyword">or</span> <span class="property">@defaultMaxYFrame</span>
    @

  <span class="attribute">setMaxY1Frame</span>: <span class="function"><span class="params">(maxY1Frame)</span> =&gt;</span>
    <span class="property">@maxY1Frame</span> = maxY1Frame <span class="keyword">or</span> <span class="property">@defaultMaxY1Frame</span>
    @


  <span class="attribute">setXFrame</span>: <span class="function"><span class="params">(xFrame)</span> =&gt;</span>
    <span class="property">@xOld</span> = d3.scale.linear()
      .domain(<span class="property">@x</span>.domain())
      .range(<span class="property">@x</span>.range())

    <span class="property">@yOld</span> = d3.scale.linear()
      .domain(<span class="property">@y</span>.domain())
      .range(<span class="property">@y</span>.range())
    <span class="property">@yOld</span>.magnitude = d3.scale.linear()
      .domain(<span class="property">@y</span>.magnitude.domain())
      .range(<span class="property">@y</span>.magnitude.range())

    <span class="property">@y1Old</span> = d3.scale.linear()
      .domain(<span class="property">@y1</span>.domain())
      .range(<span class="property">@y1</span>.range())
    <span class="property">@y1Old</span>.magnitude = d3.scale.linear()
      .domain(<span class="property">@y1</span>.magnitude.domain())
      .range(<span class="property">@y1</span>.magnitude.range())

    <span class="property">@x</span>.domain(xFrame)
    @

  <span class="attribute">setYFrame</span>: <span class="function"><span class="params">(yFrame)</span> =&gt;</span>
    <span class="property">@y</span>.domain(yFrame)
    @

  <span class="attribute">setY1Frame</span>: <span class="function"><span class="params">(y1Frame)</span> =&gt;</span>
    <span class="property">@y1</span>.domain(y1Frame)
    @

  <span class="attribute">resetXFrame</span>:<span class="function"> =&gt;</span>
    <span class="property">@setXFrame</span>([NaN, NaN])

  <span class="attribute">resetYFrame</span>:<span class="function"> =&gt;</span>
    <span class="property">@setYFrame</span>([NaN, NaN])

  <span class="attribute">resetY1Frame</span>:<span class="function"> =&gt;</span>
    <span class="property">@setY1Frame</span>([NaN, NaN])


  <span class="attribute">setAutoScale</span>: <span class="function"><span class="params">(val)</span> =&gt;</span>
    <span class="keyword">if</span> val
      <span class="keyword">delete</span> <span class="property">@availableXFrame</span>
      <span class="keyword">delete</span> <span class="property">@availableYFrame</span>
      <span class="keyword">delete</span> <span class="property">@availableY1Frame</span>
      <span class="property">@setXFrame</span>([NaN, NaN])
      <span class="property">@setYFrame</span>([NaN, NaN])
      <span class="property">@setY1Frame</span>([NaN, NaN])

    <span class="property">@autoScale</span> = val
    @

  <span class="attribute">setPadding</span>: <span class="function"><span class="params">(padding)</span> =&gt;</span>
    <span class="keyword">return</span> <span class="property">@padding</span> <span class="keyword">unless</span> padding
    <span class="property">@padding</span> = padding
    <span class="property">@setSize</span>()
    @

  <span class="attribute">initSeriesStackData</span>: <span class="function"><span class="params">(options = {overwrite: <span class="literal">false</span>})</span> -&gt;</span>
    <span class="keyword">return</span> <span class="keyword">if</span> <span class="property">@dataInitialized</span> <span class="keyword">and</span> <span class="keyword">not</span> options.overwrite</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Initialize each serie&#39;s stack data
BEGIN</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    seriesData = <span class="property">@series</span>.map<span class="function"><span class="params">((d) =&gt;
      <span class="property">@_data</span>.map(d.dataTransform))</span>

    <span class="title">layout</span> = <span class="title">d3</span>.<span class="title">layout</span>.<span class="title">stack</span><span class="params">()</span>
    <span class="title">layout</span>.<span class="title">offset</span><span class="params">(<span class="property">@offset</span>)</span>
    <span class="title">stackedData</span> = <span class="title">layout</span><span class="params">(seriesData)</span>

    <span class="title">i</span> = 0
    <span class="title">maxLen</span> = 0
    <span class="title">while</span> <span class="title">i</span> &lt; <span class="title">stackedData</span>.<span class="title">length</span>
      <span class="title">maxLen</span> = <span class="title">Math</span>.<span class="title">max</span><span class="params">(maxLen, stackedData[i].length)</span>
      <span class="title">i</span>++

    <span class="title">i</span> = 0
    <span class="title">y00</span> = 0
    <span class="title">while</span> <span class="title">i</span> &lt; <span class="title">maxLen</span>
      <span class="title">j</span> = 0
      <span class="title">while</span> <span class="title">j</span> &lt; <span class="title">stackedData</span>.<span class="title">length</span>
        <span class="title">if</span> <span class="title">stackedData</span>[<span class="title">j</span>][<span class="title">i</span>]
          <span class="title">y00</span> = 0 <span class="title">if</span> @<span class="title">utils</span>.<span class="title">ourFunctor</span><span class="params">(<span class="property">@series</span>[j].fromBaseline, stackedData[j][i], i)</span>
          <span class="title">stackedData</span>[<span class="title">j</span>][<span class="title">i</span>].<span class="title">y00</span> = <span class="title">y00</span>
          <span class="title">y00</span> += <span class="title">stackedData</span>[<span class="title">j</span>][<span class="title">i</span>].<span class="title">y</span>
        <span class="title">j</span>++
      <span class="title">i</span>++

    <span class="title">i</span> = 0
    @<span class="title">series</span>.<span class="title">forEach</span> <span class="params">(series)</span> -&gt;</span>
      series.stack = stackedData[i++]</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>END</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@dataInitialized</span> = <span class="literal">true</span>

  <span class="attribute">render</span>: <span class="function"><span class="params">(transitionSpeed, options = {})</span> -&gt;</span>
    <span class="keyword">if</span> <span class="property">@renderers</span> <span class="keyword">is</span> <span class="literal">undefined</span> <span class="keyword">or</span> _.isEmpty(<span class="property">@renderers</span>) <span class="keyword">or</span> <span class="property">@_allSeriesDisabled</span>()
      <span class="property">@vis</span>?.remove()
      <span class="property">@draggableVis</span>?.remove()
      <span class="keyword">return</span>

    <span class="property">@initSeriesStackData</span>()
    <span class="property">@_setupCanvas</span>()
    <span class="property">@stackData</span>()

    <span class="property">@discoverRange</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>related to the zooming/dragging
must be called after @discoverRange, but it&#39;s not needed to run it for each renderer</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@_checkXDomain</span>()
    <span class="property">@_checkYDomain</span>()
    <span class="property">@_checkY1Domain</span>()
    <span class="property">@_calculateXRange</span>()

    <span class="keyword">if</span> <span class="property">@animateShowHide</span> <span class="keyword">and</span> <span class="property">@renderers_to_delete</span>.length
      <span class="property">@svg</span>.selectAll(<span class="string">".draggable-canvas &gt; g:not([class*='tick']) *"</span>)
        .transition()
        .duration(<span class="property">@transitionSpeed</span> / <span class="number">2</span>)
        .attr(<span class="string">"transform"</span>, <span class="string">"translate(0,<span class="subst">#{<span class="property">@outerHeight</span>}</span>)"</span>)
      cnt = <span class="property">@svg</span>.selectAll(<span class="string">".canvas &gt; g:not([class*='tick']) *"</span>)[<span class="number">0</span>].length
      <span class="property">@svg</span>.selectAll(<span class="string">".canvas &gt; g:not([class*='tick']) *"</span>)
        .transition()
        .duration(<span class="property">@transitionSpeed</span> / <span class="number">2</span>)
        .attr(<span class="string">"transform"</span>, <span class="string">"translate(0,<span class="subst">#{<span class="property">@outerHeight</span>}</span>)"</span>)
        .each <span class="string">"end"</span>, <span class="function"><span class="params">(d, i)</span> =&gt;</span>
          <span class="keyword">return</span> <span class="keyword">if</span> i != (cnt-<span class="number">1</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>updateSeries</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          _.each <span class="property">@renderers_to_delete</span>, <span class="function"><span class="params">(r)</span> -&gt;</span>
            r.<span class="keyword">delete</span>()
          <span class="property">@renderers_to_delete</span> = []

          <span class="property">@renderAxes</span>(transitionSpeed, options)
          <span class="property">@renderChart</span>(transitionSpeed, options)
    <span class="keyword">else</span>
      <span class="property">@animateShowHide</span> = <span class="literal">false</span>
      <span class="property">@renderAxes</span>(transitionSpeed, options)
      <span class="property">@renderChart</span>(transitionSpeed, options)


  <span class="attribute">renderAxes</span>: <span class="function"><span class="params">(transitionSpeed, options= {})</span> -&gt;</span>
    <span class="property">@initAxes</span>(<span class="property">@newAxes</span>) <span class="keyword">if</span> <span class="property">@newAxes</span>

    <span class="property">@_calculateXRange</span>()

    transitionSpeed = <span class="property">@transitionSpeed</span> <span class="keyword">if</span> transitionSpeed <span class="keyword">is</span> <span class="literal">undefined</span>
    <span class="keyword">unless</span> _.isEmpty(<span class="property">@newAxes</span>)
      t = <span class="property">@svg</span>.transition().duration(<span class="keyword">if</span> <span class="property">@timesRendered</span> <span class="keyword">then</span> transitionSpeed <span class="keyword">else</span> <span class="number">0</span>)
    <span class="keyword">else</span>
      t = <span class="property">@svg</span>.transition().duration(transitionSpeed)
    _.each <span class="property">@axesList</span>, <span class="function"><span class="params">(axis)</span> =&gt;</span>
      axis.render(t)

    <span class="property">@newAxes</span> = <span class="literal">undefined</span>


  <span class="attribute">renderChart</span>: <span class="function"><span class="params">(transitionSpeed, options= {})</span> -&gt;</span>
    transitionSpeed = <span class="property">@transitionSpeed</span> <span class="keyword">if</span> transitionSpeed <span class="keyword">is</span> <span class="literal">undefined</span>
    t = <span class="property">@svg</span>.transition().duration(<span class="keyword">if</span> <span class="property">@timesRendered</span> <span class="keyword">then</span> transitionSpeed <span class="keyword">else</span> <span class="number">0</span>)

    _.each <span class="property">@renderers</span>, <span class="function"><span class="params">(renderer, i)</span> =&gt;</span>
      renderer.animateShowHide = <span class="property">@animateShowHide</span>
      renderer.render(t, <span class="literal">true</span>, transitionSpeed)
    <span class="property">@animateShowHide</span> = <span class="literal">false</span>

    _.each <span class="property">@gridList</span>, <span class="function"><span class="params">(grid)</span> =&gt;</span>
      grid.render(t)</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>@_setupZoom()</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@timesRendered</span>++

    <span class="property">@updateCallbacks</span>.forEach <span class="function"><span class="params">(callback)</span> -&gt;</span>
      callback()


  <span class="attribute">update</span>:<span class="function"> -&gt;</span>
    <span class="property">@render</span>()

  <span class="attribute">discoverRange</span>:<span class="function"> =&gt;</span>
    xDomain = []
    yDomain = []
    y1Domain = []
    _.each <span class="property">@renderers</span>, <span class="function"><span class="params">(renderer)</span> =&gt;</span>
      <span class="keyword">if</span> renderer.cartesian
        domain = renderer.domain()
        xDomain = domain.x <span class="keyword">if</span> xDomain.length <span class="keyword">is</span> <span class="number">0</span>
        yDomain = domain.y <span class="keyword">if</span> yDomain.length <span class="keyword">is</span> <span class="number">0</span>
        xDomain[<span class="number">0</span>] = domain.x[<span class="number">0</span>] <span class="keyword">if</span> xDomain[<span class="number">0</span>] &gt; domain.x[<span class="number">0</span>]
        xDomain[<span class="number">1</span>] = domain.x[<span class="number">1</span>] <span class="keyword">if</span> xDomain[<span class="number">1</span>] &lt; domain.x[<span class="number">1</span>]
        yDomain[<span class="number">0</span>] = domain.y[<span class="number">0</span>] <span class="keyword">if</span> yDomain[<span class="number">0</span>] &gt; domain.y[<span class="number">0</span>]
        yDomain[<span class="number">1</span>] = domain.y[<span class="number">1</span>] <span class="keyword">if</span> yDomain[<span class="number">1</span>] &lt; domain.y[<span class="number">1</span>]
        <span class="keyword">unless</span> renderer.series.ofDefaultAxis()
          y1Domain = [<span class="number">0</span>, d3.max(<span class="property">@series</span>.ofAlternateScale().flat(<span class="string">'y'</span>))] <span class="keyword">if</span> y1Domain.length <span class="keyword">is</span> <span class="number">0</span>


    <span class="keyword">unless</span> <span class="property">@availableXFrame</span> <span class="keyword">then</span> <span class="property">@_autoSetAvailableXFrame</span> = <span class="literal">true</span>
    <span class="keyword">unless</span> <span class="property">@availableYFrame</span> <span class="keyword">then</span> <span class="property">@_autoSetAvailableYFrame</span> = <span class="literal">true</span>
    <span class="keyword">unless</span> <span class="property">@availableY1Frame</span> <span class="keyword">then</span> <span class="property">@_autoSetAvailableY1Frame</span> = <span class="literal">true</span>

    <span class="keyword">if</span> <span class="property">@_autoSetAvailableXFrame</span> <span class="keyword">then</span> <span class="property">@availableXFrame</span> = xDomain

    <span class="keyword">if</span> <span class="property">@_autoSetAvailableYFrame</span>
      min = yDomain[<span class="number">0</span>]
      max = yDomain[<span class="number">1</span>]
      <span class="keyword">if</span> yDomain[<span class="number">0</span>] &gt; <span class="number">0</span> <span class="keyword">and</span> yDomain[<span class="number">1</span>] &gt; <span class="number">0</span> <span class="keyword">then</span> min = <span class="number">0</span>
      <span class="keyword">if</span> yDomain[<span class="number">0</span>] &lt; <span class="number">0</span> <span class="keyword">and</span> yDomain[<span class="number">1</span>] &lt; <span class="number">0</span> <span class="keyword">then</span> max = <span class="number">0</span>
      <span class="property">@availableYFrame</span> = [min + min*<span class="number">0.1</span>, max + max*<span class="number">0.1</span>]

    <span class="keyword">if</span> <span class="property">@_autoSetAvailableY1Frame</span>
      min = y1Domain[<span class="number">0</span>]
      max = y1Domain[<span class="number">1</span>]
      <span class="keyword">if</span> y1Domain[<span class="number">0</span>] &gt; <span class="number">0</span> <span class="keyword">and</span> y1Domain[<span class="number">1</span>] &gt; <span class="number">0</span> <span class="keyword">then</span> min = <span class="number">0</span>
      <span class="keyword">if</span> y1Domain[<span class="number">0</span>] &lt; <span class="number">0</span> <span class="keyword">and</span> y1Domain[<span class="number">1</span>] &lt; <span class="number">0</span> <span class="keyword">then</span> max = <span class="number">0</span>
      <span class="property">@availableY1Frame</span> = [min + min*<span class="number">0.1</span>, max + max*<span class="number">0.1</span>]

    <span class="keyword">if</span> _.isNaN(<span class="property">@x</span>.domain()[<span class="number">0</span>]) <span class="keyword">or</span> _.isNaN(<span class="property">@x</span>.domain()[<span class="number">1</span>])
      <span class="property">@x</span>.domain(<span class="property">@availableXFrame</span>)

    <span class="keyword">if</span> _.isNaN(<span class="property">@y</span>.domain()[<span class="number">0</span>]) <span class="keyword">or</span> _.isNaN(<span class="property">@y</span>.domain()[<span class="number">1</span>]) <span class="keyword">or</span> <span class="property">@autoScale</span>
      <span class="property">@y</span>.domain(<span class="property">@availableYFrame</span>)
      <span class="property">@y</span>.magnitude.domain([<span class="number">0</span>, <span class="property">@availableYFrame</span>[<span class="number">1</span>] - <span class="property">@availableYFrame</span>[<span class="number">0</span>]])

    <span class="keyword">if</span> _.isNaN(<span class="property">@y1</span>.domain()[<span class="number">0</span>]) <span class="keyword">or</span> _.isNaN(<span class="property">@y1</span>.domain()[<span class="number">1</span>]) <span class="keyword">or</span> <span class="property">@autoScale</span>
      <span class="property">@y1</span>.domain(<span class="property">@availableY1Frame</span>)
      <span class="property">@y1</span>.magnitude.domain([<span class="number">0</span>, <span class="property">@availableY1Frame</span>[<span class="number">1</span>] - <span class="property">@availableY1Frame</span>[<span class="number">0</span>]])

    @

  <span class="attribute">yMin</span>: <span class="function"><span class="params">(yMin)</span> -&gt;</span>
    <span class="keyword">return</span> <span class="property">@min</span> <span class="keyword">unless</span> yMin
    <span class="property">@min</span> = yMin
    @

  <span class="attribute">initAxes</span>: <span class="function"><span class="params">(args)</span> -&gt;</span>
    <span class="keyword">return</span> <span class="property">@axesList</span> <span class="keyword">unless</span> args</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>save prev axisPadding</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@prevAxisPadding</span> = _.clone <span class="property">@axisPadding</span></pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>kill any old axes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each _.toArray<span class="function"><span class="params">(<span class="property">@axesList</span>)</span>, <span class="params">(axis)</span> -&gt;</span> axis.destroy()

    _.each [<span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'y1'</span>], <span class="function"><span class="params">(k)</span> =&gt;</span>
      <span class="keyword">if</span> args[k]?
        defaults =
          <span class="attribute">graph</span>: @
          <span class="attribute">dimension</span>: <span class="property">@defaultAxesOptions</span>[k].dimension
          <span class="attribute">frame</span>: <span class="property">@defaultAxesOptions</span>[k].frame
          <span class="attribute">axis</span>: k
          <span class="attribute">showZeroLine</span>: <span class="property">@defaultAxesOptions</span>[k].showZeroLine

        <span class="property">@initAxis</span> _.extend defaults, args[k]

    @
  <span class="attribute">axes</span>: <span class="function"><span class="params">(args)</span> -&gt;</span>
    <span class="keyword">return</span> @ <span class="keyword">unless</span> args
    <span class="property">@newAxes</span> = args
    @

  <span class="attribute">grid</span>: <span class="function"><span class="params">(args)</span> -&gt;</span>
    <span class="keyword">return</span> <span class="property">@gridList</span> <span class="keyword">unless</span> args</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>kill any old grids</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each _.toArray<span class="function"><span class="params">(<span class="property">@gridList</span>)</span>, <span class="params">(grid)</span> -&gt;</span> grid.destroy()

    _.each [<span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'y1'</span>], <span class="function"><span class="params">(k)</span> =&gt;</span>
      <span class="keyword">if</span> args[k]?
        defaults = {<span class="attribute">graph</span>: @, <span class="attribute">grid</span>: k}
        <span class="property">@gridList</span>[k] = <span class="keyword">new</span> Tactile.Grid _.extend defaults, args[k]

    @


  <span class="attribute">initAxis</span>: <span class="function"><span class="params">(args)</span> -&gt;</span>
    <span class="keyword">return</span> <span class="keyword">unless</span> <span class="property">@_allRenderersCartesian</span>()
    <span class="keyword">switch</span> args.dimension
      <span class="keyword">when</span> <span class="string">"linear"</span>
        <span class="property">@axesList</span>[args.axis] = <span class="keyword">new</span> Tactile.AxisLinear args
      <span class="keyword">when</span> <span class="string">"time"</span>
        <span class="property">@axesList</span>[args.axis] = <span class="keyword">new</span> Tactile.AxisTime args
      <span class="keyword">else</span>
        Tactile.Utils.warn(<span class="string">"Tactile error: <span class="subst">#{args.dimension}</span> is not currently implemented"</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Used by range slider</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="attribute">dataDomain</span>:<span class="function"> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>take from the first series</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    data = <span class="property">@renderers</span>[<span class="number">0</span>].series.stack
    [data[<span class="number">0</span>].x, data.slice(-<span class="number">1</span>).shift().x]

  <span class="attribute">stackData</span>:<span class="function"> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Read more about stacking data here:
<a href="https://github.com/mbostock/d3/wiki/Stack-Layout">https://github.com/mbostock/d3/wiki/Stack-Layout</a></p>
<p>select data of default scale only, so we can handle y1 axis data separately</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    defaultScaleSeriesData = <span class="property">@series</span>.active<span class="function"><span class="params">()</span>.<span class="title">ofDefaultAxis</span><span class="params">()</span>.<span class="title">array</span>.<span class="title">map</span><span class="params">((s) =&gt; <span class="property">@_data</span>.map(s.dataTransform))</span>

    <span class="title">layout</span> = <span class="title">d3</span>.<span class="title">layout</span>.<span class="title">stack</span><span class="params">()</span>
    <span class="title">layout</span>.<span class="title">offset</span><span class="params">(<span class="property">@offset</span>)</span>
    @<span class="title">stackedData</span> = <span class="title">layout</span><span class="params">(defaultScaleSeriesData)</span>

    <span class="title">i</span> = 0
    <span class="title">maxLen</span> = 0
    <span class="title">while</span> <span class="title">i</span> &lt; @<span class="title">stackedData</span>.<span class="title">length</span>
      <span class="title">maxLen</span> = <span class="title">Math</span>.<span class="title">max</span><span class="params">(maxLen, <span class="property">@stackedData</span>[i].length)</span>
      <span class="title">i</span>++

    <span class="title">i</span> = 0
    <span class="title">y00</span> = 0
    <span class="title">while</span> <span class="title">i</span> &lt; <span class="title">maxLen</span>
      <span class="title">j</span> = 0
      <span class="title">while</span> <span class="title">j</span> &lt; @<span class="title">stackedData</span>.<span class="title">length</span>
        <span class="title">if</span> @<span class="title">stackedData</span>[<span class="title">j</span>][<span class="title">i</span>]
          <span class="title">y00</span> = 0 <span class="title">if</span> @<span class="title">utils</span>.<span class="title">ourFunctor</span><span class="params">(<span class="property">@series</span>[j].fromBaseline, <span class="property">@stackedData</span>[j][i], i)</span>
          @<span class="title">stackedData</span>[<span class="title">j</span>][<span class="title">i</span>].<span class="title">y00</span> = <span class="title">y00</span>
          <span class="title">y00</span> += @<span class="title">stackedData</span>[<span class="title">j</span>][<span class="title">i</span>].<span class="title">y</span>
        <span class="title">j</span>++
      <span class="title">i</span>++</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Set&#39;s the size for the chart
please note you have to call render() or update()
for this changes to be reflected in your chart</p>
<p>outerWith, outerHeight - no paddings subtracted
innerWidth, innerHeight - paddings subtracted
width(), height() returns innerWidth as it&#39;s the most common used</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="attribute">setSize</span>: <span class="function"><span class="params">(args = {})</span> -&gt;</span>
    elWidth  = $(<span class="property">@_element</span>).width()
    elHeight = $(<span class="property">@_element</span>).height()

    <span class="property">@outerWidth</span> = args.width || elWidth || <span class="property">@defaultWidth</span>
    <span class="property">@outerHeight</span> = args.height || elHeight || <span class="property">@defaultHeight</span>

    <span class="property">@innerWidth</span> = <span class="property">@outerWidth</span> - <span class="property">@padding</span>.left - <span class="property">@padding</span>.right - <span class="property">@axisPadding</span>.left - <span class="property">@axisPadding</span>.right
    <span class="property">@innerHeight</span> = <span class="property">@outerHeight</span> - <span class="property">@padding</span>.top - <span class="property">@padding</span>.bottom - <span class="property">@axisPadding</span>.top - <span class="property">@axisPadding</span>.bottom

    <span class="property">@x</span>?.range([<span class="number">0</span>, <span class="property">@width</span>()])
    <span class="property">@y</span>?.range([<span class="property">@height</span>(), <span class="number">0</span>])
    <span class="property">@y</span>?.magnitude.range([<span class="number">0</span>, <span class="property">@height</span>()])
    <span class="property">@y1</span>?.range([<span class="property">@height</span>(), <span class="number">0</span>])
    <span class="property">@y1</span>?.range([<span class="number">0</span>, <span class="property">@height</span>()])


    <span class="property">@vis</span>?.attr(<span class="string">'width'</span>, <span class="property">@innerWidth</span>).attr(<span class="string">'height'</span>, <span class="property">@innerHeight</span>)
    <span class="property">@_updateRange</span>()
    <span class="property">@_setupCanvas</span>()

    @

  <span class="attribute">_setupZoom</span>:<span class="function"> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>   @y.magnitude.domain([0, @y.domain()[1] - @y.domain()[0]])
   @y1.magnitude.domain([0, @y1.domain()[1] - @y1.domain()[0]])
   zoom = d3.behavior.zoom()
   d3.select(@_element)
     .on(&quot;mousedown.plot-drag&quot;, @_plotDrag)
     .on(&quot;touchstart.plot-drag&quot;, @_plotDrag)
     .on(&quot;mousemove.drag&quot;, @_mousemove)
     .on(&quot;touchmove.drag&quot;, @_mousemove)
     .on(&quot;mouseup.plot-drag&quot;,   @_mouseup)
     .on(&quot;touchend.plot-drag&quot;,  @_mouseup)</p>
<p>   unless @autoScale
     d3.select(@svg[0][0])
       .call(zoom.x(@x).y(@y).on(&quot;zoom&quot;, =&gt;
         return if @autoScale
         dy = d3.event.translate[1] - @_lastYTranslate
         dy1 = (dy / (@y.domain()[1] - @y.domain()[0])) <em> (@y1.domain()[1] - @y1.domain()[0])
         @y1.domain([@y1.domain()[0] + dy1, @y1.domain()[1] + dy1])
         @y1.domain([@y1.domain()[0] </em> d3.event.scale, @y1.domain()[1] / d3.event.scale])
         @_lastYTranslate = d3.event.translate[1];
         @_checkXDomain()
         @_checkYDomain()
         @_checkY1Domain()</p>
<pre><code>     @manipulateCallbacks.forEach (callback) -&gt;
       callback()
     @render(0, zooming: true)
   ))</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="attribute">_setupDomainAndRange</span>:<span class="function"> -&gt;</span>
    <span class="property">@x</span> = d3.scale.linear()
      .domain([NaN, NaN])
    <span class="property">@y</span> = d3.scale.linear()
      .domain([NaN, NaN])
    <span class="property">@y</span>.magnitude = d3.scale.linear()
    <span class="property">@y1</span> = d3.scale.linear()
      .domain([NaN, NaN])
    <span class="property">@y1</span>.magnitude = d3.scale.linear()
    <span class="property">@_updateRange</span>()

  <span class="attribute">_updateRange</span>:<span class="function"> -&gt;</span>
    <span class="property">@x</span>.range([<span class="number">0</span>, <span class="property">@width</span>()])
    <span class="property">@y</span>.range([<span class="property">@height</span>(), <span class="number">0</span>])
    <span class="property">@y</span>.magnitude.range([<span class="number">0</span>, <span class="property">@height</span>()])
    <span class="property">@y1</span>.range([<span class="property">@height</span>(), <span class="number">0</span>])
    <span class="property">@y1</span>.magnitude.range([<span class="number">0</span>, <span class="property">@height</span>()])

  <span class="attribute">onUpdate</span>: <span class="function"><span class="params">(callback)</span> -&gt;</span>
    <span class="property">@updateCallbacks</span>.push callback

  <span class="attribute">onManipulate</span>: <span class="function"><span class="params">(callback)</span> -&gt;</span>
    <span class="property">@manipulateCallbacks</span>.push callback

  <span class="attribute">onElementChange</span>: <span class="function"><span class="params">(callback)</span> -&gt;</span>
    <span class="property">@elementChangeCallbacks</span>.push callback

  <span class="attribute">initRenderers</span>: <span class="function"><span class="params">(series)</span> -&gt;</span>
    renderersSize = <span class="property">@renderers</span>.length
    _.each series, <span class="function"><span class="params">(s, index)</span> =&gt;</span>
      name = s.renderer
      <span class="keyword">throw</span> <span class="string">"couldn't find renderer <span class="subst">#{name}</span>"</span> <span class="keyword">if</span> (!<span class="property">@_renderers</span>[name])
      rendererClass = <span class="property">@_renderers</span>[name]
      rendererOptions = _.extend {},
        <span class="attribute">graph</span>: @
        <span class="attribute">transitionSpeed</span>: <span class="property">@transitionSpeed</span>
        <span class="attribute">series</span>: s
        <span class="attribute">rendererIndex</span>: index + renderersSize
      <span class="keyword">if</span> s.aggregate <span class="keyword">is</span> <span class="literal">true</span>
        <span class="property">@aggregated</span>[name] = <span class="literal">true</span>
      r = <span class="keyword">new</span> rendererClass(rendererOptions)
      r.animateShowHide = <span class="property">@animateShowHide</span>
      <span class="property">@renderers</span>.push r

  <span class="attribute">renderersByType</span>: <span class="function"><span class="params">(name)</span> -&gt;</span>
    <span class="property">@renderers</span>.filter<span class="function"><span class="params">((r) -&gt; r.name == name)</span>

  <span class="title">clearRenderers</span>: -&gt;</span>
    <span class="keyword">return</span> <span class="keyword">if</span> _.isEmpty(<span class="property">@renderers</span>)
    <span class="property">@renderers_to_delete</span> = _.clone <span class="property">@renderers</span></pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>   _.each @renderers_to_delete, (r) -&gt;
     r.delete()</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@renderers</span> = []
    <span class="property">@timesRendered</span> = <span class="number">0</span>

  <span class="attribute">stackTransition</span>: <span class="function"><span class="params">(transitionSpeed)</span> =&gt;</span>
    transitionSpeed = <span class="property">@transitionSpeed</span> <span class="keyword">if</span> transitionSpeed <span class="keyword">is</span> <span class="literal">undefined</span>
    t = <span class="property">@svg</span>.transition().duration(transitionSpeed)
    _.each<span class="function"><span class="params">(<span class="property">@renderersByType</span>(<span class="string">'column'</span>), (r) -&gt; r.unstack = <span class="literal">false</span>)</span>
    <span class="title">_</span>.<span class="title">each</span><span class="params">(<span class="property">@renderersByType</span>(<span class="string">'column'</span>), (r) -&gt; r.stackTransition(t, transitionSpeed))</span>
    <span class="title">_</span>.<span class="title">each</span><span class="params">(<span class="property">@renderersByType</span>(<span class="string">'area'</span>), (r) -&gt; r.unstack = <span class="literal">false</span>)</span>
    <span class="title">_</span>.<span class="title">each</span><span class="params">(<span class="property">@renderersByType</span>(<span class="string">'area'</span>), (r) -&gt; r.stackTransition(t, transitionSpeed))</span>
    <span class="title">_</span>.<span class="title">each</span><span class="params">(<span class="property">@renderersByType</span>(<span class="string">'donut'</span>), (r) -&gt; r.unstack = <span class="literal">false</span>)</span>
    <span class="title">_</span>.<span class="title">each</span><span class="params">(<span class="property">@renderersByType</span>(<span class="string">'donut'</span>), (r) -&gt; r.stackTransition(t, transitionSpeed))</span></pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>@_setupZoom()</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each  <span class="property">@axesList</span>, <span class="function"><span class="params">(axis)</span> =&gt;</span>
      axis.render(t)


  <span class="attribute">unstackTransition</span>: <span class="function"><span class="params">(transitionSpeed)</span> =&gt;</span>
    transitionSpeed = <span class="property">@transitionSpeed</span> <span class="keyword">if</span> transitionSpeed <span class="keyword">is</span> <span class="literal">undefined</span>
    t = <span class="property">@svg</span>.transition().duration(transitionSpeed)
    _.each<span class="function"><span class="params">(<span class="property">@renderersByType</span>(<span class="string">'column'</span>), (r) -&gt; r.unstack = <span class="literal">true</span>)</span>
    <span class="title">_</span>.<span class="title">each</span><span class="params">(<span class="property">@renderersByType</span>(<span class="string">'column'</span>), (r) -&gt; r.unstackTransition(t, transitionSpeed))</span>
    <span class="title">_</span>.<span class="title">each</span><span class="params">(<span class="property">@renderersByType</span>(<span class="string">'area'</span>), (r) -&gt; r.unstack = <span class="literal">true</span>)</span>
    <span class="title">_</span>.<span class="title">each</span><span class="params">(<span class="property">@renderersByType</span>(<span class="string">'area'</span>), (r) -&gt; r.unstackTransition(t, transitionSpeed))</span>
    <span class="title">_</span>.<span class="title">each</span><span class="params">(<span class="property">@renderersByType</span>(<span class="string">'donut'</span>), (r) -&gt; r.unstack = <span class="literal">true</span>)</span>
    <span class="title">_</span>.<span class="title">each</span><span class="params">(<span class="property">@renderersByType</span>(<span class="string">'donut'</span>), (r) -&gt; r.unstackTransition(t, transitionSpeed))</span></pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>@_setupZoom()</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each  <span class="property">@axesList</span>, <span class="function"><span class="params">(axis)</span> =&gt;</span>
      axis.render(t)</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <h6 id="-">#</h6>
<p>expose public variables</p>
<h6 id="-">#</h6>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="attribute">element</span>: <span class="function"><span class="params">(val)</span> =&gt;</span>
    <span class="keyword">return</span> <span class="property">@_element</span> <span class="keyword">unless</span> val
    <span class="property">@_element</span> = val

    <span class="property">@_setupCanvas</span>()
    <span class="property">@elementChangeCallbacks</span>.forEach <span class="function"><span class="params">(callback)</span> -&gt;</span> callback()
    @

  <span class="attribute">height</span>: <span class="function"><span class="params">(val)</span> -&gt;</span>
    <span class="keyword">return</span> (<span class="property">@innerHeight</span> <span class="keyword">or</span> <span class="property">@defaultHeight</span>) <span class="keyword">unless</span> val
    <span class="property">@setSize</span>(<span class="attribute">width</span>: <span class="property">@outerWidth</span>, <span class="attribute">height</span>: val)
    @

  <span class="attribute">width</span>: <span class="function"><span class="params">(val)</span> -&gt;</span>
    <span class="keyword">return</span> (<span class="property">@innerWidth</span> <span class="keyword">or</span> <span class="property">@defaultWidth</span>) <span class="keyword">unless</span> val
    <span class="property">@setSize</span>(<span class="attribute">width</span>: val, <span class="attribute">height</span>: <span class="property">@outerHeight</span>)
    @

  <span class="attribute">setPadding</span>: <span class="function"><span class="params">(val)</span> -&gt;</span>
    <span class="keyword">return</span> (<span class="property">@padding</span>) <span class="keyword">unless</span> val <span class="keyword">or</span> _.isEmpty(val)</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>recalculate the range</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@padding</span> = val
    <span class="property">@setSize</span>(<span class="attribute">width</span>: <span class="property">@outerWidth</span>, <span class="attribute">height</span>: <span class="property">@outerHeight</span>)
    @

  <span class="attribute">data</span>: <span class="function"><span class="params">(val)</span> -&gt;</span>
    <span class="keyword">return</span> <span class="property">@_data</span> <span class="keyword">unless</span> val
    <span class="property">@_data</span> = val
    <span class="property">@dataInitialized</span> = <span class="literal">false</span>
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <h6 id="-">#</h6>
<p>private methods</p>
<h6 id="-">#</h6>
<p>Appends or updates all the chart canvas elements
so it respects the paddings
done by following this example: <a href="http://bl.ocks.org/3019563">http://bl.ocks.org/3019563</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="attribute">_setupCanvas</span>:<span class="function"> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>need a constant class name for a containing div</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="property">@_element</span>).addClass(<span class="string">'graph-container'</span>)
    <span class="property">@svg</span> = <span class="property">@_findOrAppend</span>(<span class="attribute">what</span>: <span class="string">'svg'</span>, <span class="attribute">in</span>: d3.select(<span class="property">@_element</span>))

    <span class="property">@svg</span>
      .attr(<span class="string">'width'</span>, <span class="property">@outerWidth</span>)
      .attr(<span class="string">'height'</span>, <span class="property">@outerHeight</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>this is the canvas on which all data should be drawn</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@vis</span> = <span class="property">@_findOrAppend</span>(<span class="attribute">what</span>: <span class="string">'g'</span>, <span class="attribute">in</span>: <span class="property">@svg</span>, <span class="attribute">selector</span>: <span class="string">'g.canvas'</span>)
      .attr(<span class="string">"transform"</span>, <span class="string">"translate(<span class="subst">#{<span class="property">@padding</span>.left + <span class="property">@axisPadding</span>.left}</span>,<span class="subst">#{<span class="property">@padding</span>.top + <span class="property">@axisPadding</span>.top}</span>)"</span>)
      .attr(<span class="string">"class"</span>, <span class="string">"canvas"</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>this is the canvas on which all draggable data should be drawn</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@draggableVis</span> = <span class="property">@_findOrAppend</span>(<span class="attribute">what</span>: <span class="string">'g'</span>, <span class="attribute">in</span>: <span class="property">@svg</span>, <span class="attribute">selector</span>: <span class="string">'g.draggable-canvas'</span>)
      .attr(<span class="string">"transform"</span>, <span class="string">"translate(<span class="subst">#{<span class="property">@padding</span>.left + <span class="property">@axisPadding</span>.left}</span>,<span class="subst">#{<span class="property">@padding</span>.top + <span class="property">@axisPadding</span>.top}</span>)"</span>)
      .attr(<span class="string">"class"</span>, <span class="string">"draggable-canvas"</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Add the default clip path.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    clip = <span class="property">@_findOrAppend</span>(<span class="attribute">what</span>: <span class="string">'clipPath'</span>, <span class="attribute">selector</span>: <span class="string">'#clip'</span>, <span class="attribute">in</span>: <span class="property">@vis</span>)
      .attr(<span class="string">"id"</span>, <span class="string">"clip"</span>)

    <span class="property">@_findOrAppend</span>(<span class="attribute">what</span>: <span class="string">'rect'</span>, <span class="attribute">in</span>: clip)
      .attr(<span class="string">"width"</span>, <span class="property">@width</span>())</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>increase height to provide room vertically for line thickness</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      .attr(<span class="string">"height"</span>, <span class="property">@height</span>() + <span class="number">4</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>translate to adjust for increased height (split the difference)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      .attr(<span class="string">"transform"</span>, <span class="string">"translate(0,-2)"</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Add the clip path.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    scatterClip = <span class="property">@_findOrAppend</span>(<span class="attribute">what</span>: <span class="string">'clipPath'</span>, <span class="attribute">selector</span>: <span class="string">'#scatter-clip'</span>, <span class="attribute">in</span>: <span class="property">@vis</span>)
      .attr(<span class="string">"id"</span>, <span class="string">"scatter-clip"</span>)

    <span class="property">@_findOrAppend</span>(<span class="attribute">what</span>: <span class="string">'rect'</span>, <span class="attribute">in</span>: scatterClip)</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>increase width to provide room vertically for circle radius</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      .attr(<span class="string">"width"</span>, <span class="property">@width</span>() + <span class="number">12</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>increase height to provide room vertically for circle radius</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      .attr(<span class="string">"height"</span>, <span class="property">@height</span>() + <span class="number">12</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>translate to adjust for increased width and height</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      .attr(<span class="string">"transform"</span>, <span class="string">"translate(-6,-6)"</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>looks for node in given node
returns it or appends to the node in <code>in</code> option
you can pass selector it is then used to lookup for the exisiting element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="attribute">_findOrAppend</span>: <span class="function"><span class="params">(options)</span> -&gt;</span>
    element = options.<span class="keyword">in</span>
    node = options.what
    selector = options.selector <span class="keyword">or</span> node

    found = element.select(selector)
    <span class="keyword">if</span> found?[<span class="number">0</span>][<span class="number">0</span>]
      found
    <span class="keyword">else</span>
      element.append(node)</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>this trims data down to the range that is currently viewed.
See range_slider for a clue how it&#39;s used</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="attribute">_slice</span>: <span class="function"><span class="params">(d)</span> =&gt;</span>
    <span class="keyword">return</span> <span class="literal">true</span> <span class="keyword">unless</span> <span class="property">@_allRenderersCartesian</span>()
    <span class="property">@timeframe</span>[<span class="number">0</span>] &lt;= d.x &lt;= <span class="property">@timeframe</span>[<span class="number">1</span>]

  <span class="attribute">_deg2rad</span>: <span class="function"><span class="params">(deg)</span> -&gt;</span>
    deg * Math.PI / <span class="number">180</span>

  <span class="attribute">_hasDifferentRenderers</span>:<span class="function"> -&gt;</span>
    _.uniq<span class="function"><span class="params">(_.map(<span class="property">@series</span>.array, (s) -&gt; s.renderer))</span>.<span class="title">length</span> &gt; 1

  <span class="title">_containsColumnChart</span>: -&gt;</span>
    _.any<span class="function"><span class="params">(<span class="property">@renderers</span>, (r) -&gt; r.name == <span class="string">'column'</span> <span class="keyword">or</span> r.name == <span class="string">'waterfall'</span>)</span>

  <span class="title">_allRenderersCartesian</span>: -&gt;</span>
    _.every<span class="function"><span class="params">(<span class="property">@renderers</span>, (r) -&gt; r.cartesian <span class="keyword">is</span> <span class="literal">true</span>)</span>

  <span class="title">_allSeriesDisabled</span>: -&gt;</span>
    _.every<span class="function"><span class="params">(<span class="property">@series</span>.array, (s) -&gt; s.disabled <span class="keyword">is</span> <span class="literal">true</span>)</span>

  <span class="title">_plotDrag</span>: =&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>   return if @autoScale
   d3.select(&quot;body&quot;).style(&quot;cursor&quot;, &quot;move&quot;)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="attribute">_mouseup</span>:<span class="function"> =&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>   return if @autoScale
   d3.select(&quot;body&quot;).style(&quot;cursor&quot;, &quot;auto&quot;)
   @axes()?.x?._mouseUp()
   @axes()?.y?._mouseUp()
   @axes()?.y1?._mouseUp()
   @_lastYTranslate = 0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="attribute">_mousemove</span>:<span class="function"> =&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>   return if @autoScale
   @axes()?.x?._mouseMove()
   @axes()?.y?._mouseMove()
   @axes()?.y1?._mouseMove()</p>
<p>TODO: move away to a separate class. Zoomable or sth.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="attribute">_checkXDomain</span>:<span class="function"> =&gt;</span>
    min = <span class="property">@x</span>.domain()[<span class="number">0</span>]
    max = <span class="property">@x</span>.domain()[<span class="number">1</span>]

    min = <span class="property">@availableXFrame</span>[<span class="number">0</span>] <span class="keyword">if</span> min &lt; <span class="property">@availableXFrame</span>[<span class="number">0</span>]
    min = <span class="property">@availableXFrame</span>[<span class="number">1</span>] <span class="keyword">if</span> min &gt; <span class="property">@availableXFrame</span>[<span class="number">1</span>]

    max = <span class="property">@availableXFrame</span>[<span class="number">1</span>] <span class="keyword">if</span> max &gt; <span class="property">@availableXFrame</span>[<span class="number">1</span>]
    max = <span class="property">@availableXFrame</span>[<span class="number">1</span>] <span class="keyword">if</span> max &lt; <span class="property">@availableXFrame</span>[<span class="number">0</span>]

    minXFrame = <span class="property">@utils</span>.ourFunctor(<span class="property">@minXFrame</span>, [min, max])
    <span class="keyword">if</span> max - min &lt; minXFrame
      middle = (max + min) / <span class="number">2</span>
      middle = <span class="property">@availableXFrame</span>[<span class="number">1</span>] - minXFrame / <span class="number">2</span> <span class="keyword">if</span> middle + minXFrame / <span class="number">2</span> &gt; <span class="property">@availableXFrame</span>[<span class="number">1</span>]
      middle = <span class="property">@availableXFrame</span>[<span class="number">0</span>] + minXFrame / <span class="number">2</span> <span class="keyword">if</span> middle - minXFrame / <span class="number">2</span> &lt; <span class="property">@availableXFrame</span>[<span class="number">0</span>]
      min = middle - minXFrame / <span class="number">2</span>
      max = middle + minXFrame / <span class="number">2</span>

    maxXFrame = <span class="property">@utils</span>.ourFunctor(<span class="property">@maxXFrame</span>, [min, max])
    <span class="keyword">if</span> max - min &gt; maxXFrame
      middle = (max + min) / <span class="number">2</span>
      middle = <span class="property">@availableXFrame</span>[<span class="number">1</span>] - maxXFrame / <span class="number">2</span> <span class="keyword">if</span> middle + maxXFrame / <span class="number">2</span> &gt; <span class="property">@availableXFrame</span>[<span class="number">1</span>]
      middle = <span class="property">@availableXFrame</span>[<span class="number">0</span>] + maxXFrame / <span class="number">2</span> <span class="keyword">if</span> middle - maxXFrame / <span class="number">2</span> &lt; <span class="property">@availableXFrame</span>[<span class="number">0</span>]
      min = middle - maxXFrame / <span class="number">2</span>
      max = middle + maxXFrame / <span class="number">2</span>

    <span class="property">@axes</span>().x?.frame = [min, max]
    <span class="property">@x</span>.domain([min, max])

  <span class="attribute">_checkYDomain</span>:<span class="function"> =&gt;</span>
    min = <span class="property">@y</span>.domain()[<span class="number">0</span>]
    max = <span class="property">@y</span>.domain()[<span class="number">1</span>]

    min = <span class="property">@availableYFrame</span>[<span class="number">0</span>] <span class="keyword">if</span> min &lt; <span class="property">@availableYFrame</span>[<span class="number">0</span>]
    min = <span class="property">@availableYFrame</span>[<span class="number">1</span>] <span class="keyword">if</span> min &gt; <span class="property">@availableYFrame</span>[<span class="number">1</span>]

    max = <span class="property">@availableYFrame</span>[<span class="number">1</span>] <span class="keyword">if</span> max &gt; <span class="property">@availableYFrame</span>[<span class="number">1</span>]
    max = <span class="property">@availableYFrame</span>[<span class="number">1</span>] <span class="keyword">if</span> max &lt; <span class="property">@availableYFrame</span>[<span class="number">0</span>]

    minYFrame = <span class="property">@utils</span>.ourFunctor(<span class="property">@minYFrame</span>, [min, max])
    <span class="keyword">if</span> max - min &lt; minYFrame
      middle = (max + min) / <span class="number">2</span>
      middle = <span class="property">@availableYFrame</span>[<span class="number">1</span>] - minYFrame / <span class="number">2</span> <span class="keyword">if</span> middle + minYFrame / <span class="number">2</span> &gt; <span class="property">@availableYFrame</span>[<span class="number">1</span>]
      middle = <span class="property">@availableYFrame</span>[<span class="number">0</span>] + minYFrame / <span class="number">2</span> <span class="keyword">if</span> middle - minYFrame / <span class="number">2</span> &lt; <span class="property">@availableYFrame</span>[<span class="number">0</span>]
      min = middle - minYFrame / <span class="number">2</span>
      max = middle + minYFrame / <span class="number">2</span>

    maxYFrame = <span class="property">@utils</span>.ourFunctor(<span class="property">@maxYFrame</span>, [min, max])
    <span class="keyword">if</span> max - min &gt; maxYFrame
      middle = (max + min) / <span class="number">2</span>
      middle = <span class="property">@availableYFrame</span>[<span class="number">1</span>] - maxYFrame / <span class="number">2</span> <span class="keyword">if</span> middle + maxYFrame / <span class="number">2</span> &gt; <span class="property">@availableYFrame</span>[<span class="number">1</span>]
      middle = <span class="property">@availableYFrame</span>[<span class="number">0</span>] + maxYFrame / <span class="number">2</span> <span class="keyword">if</span> middle - maxYFrame / <span class="number">2</span> &lt; <span class="property">@availableYFrame</span>[<span class="number">0</span>]
      min = middle - maxYFrame / <span class="number">2</span>
      max = middle + maxYFrame / <span class="number">2</span>

    <span class="property">@axes</span>().y?.frame = [min, max]
    <span class="property">@y</span>.domain([min, max])

  <span class="attribute">_checkY1Domain</span>:<span class="function"> =&gt;</span>
    min = <span class="property">@y1</span>.domain()[<span class="number">0</span>]
    max = <span class="property">@y1</span>.domain()[<span class="number">1</span>]

    <span class="keyword">return</span> <span class="keyword">unless</span> <span class="property">@availableY1Frame</span>
    min = <span class="property">@availableY1Frame</span>[<span class="number">0</span>] <span class="keyword">if</span> min &lt; <span class="property">@availableY1Frame</span>[<span class="number">0</span>]
    min = <span class="property">@availableY1Frame</span>[<span class="number">1</span>] <span class="keyword">if</span> min &gt; <span class="property">@availableY1Frame</span>[<span class="number">1</span>]

    max = <span class="property">@availableY1Frame</span>[<span class="number">1</span>] <span class="keyword">if</span> max &gt; <span class="property">@availableY1Frame</span>[<span class="number">1</span>]
    max = <span class="property">@availableY1Frame</span>[<span class="number">1</span>] <span class="keyword">if</span> max &lt; <span class="property">@availableY1Frame</span>[<span class="number">0</span>]

    minY1Frame = <span class="property">@utils</span>.ourFunctor(<span class="property">@minY1Frame</span>, [min, max])
    <span class="keyword">if</span> max - min &lt; minY1Frame
      middle = (max + min) / <span class="number">2</span>
      middle = <span class="property">@availableY1Frame</span>[<span class="number">1</span>] - minY1Frame / <span class="number">2</span> <span class="keyword">if</span> middle + minY1Frame / <span class="number">2</span> &gt; <span class="property">@availableY1Frame</span>[<span class="number">1</span>]
      middle = <span class="property">@availableY1Frame</span>[<span class="number">0</span>] + minY1Frame / <span class="number">2</span> <span class="keyword">if</span> middle - minY1Frame / <span class="number">2</span> &lt; <span class="property">@availableY1Frame</span>[<span class="number">0</span>]
      min = middle - minY1Frame / <span class="number">2</span>
      max = middle + minY1Frame / <span class="number">2</span>

    maxY1Frame = <span class="property">@utils</span>.ourFunctor(<span class="property">@maxY1Frame</span>, [min, max])
    <span class="keyword">if</span> max - min &gt; maxY1Frame
      middle = (max + min) / <span class="number">2</span>
      middle = <span class="property">@availableY1Frame</span>[<span class="number">1</span>] - maxY1Frame / <span class="number">2</span> <span class="keyword">if</span> middle + maxY1Frame / <span class="number">2</span> &gt; <span class="property">@availableY1Frame</span>[<span class="number">1</span>]
      middle = <span class="property">@availableY1Frame</span>[<span class="number">0</span>] + maxY1Frame / <span class="number">2</span> <span class="keyword">if</span> middle - maxY1Frame / <span class="number">2</span> &lt; <span class="property">@availableY1Frame</span>[<span class="number">0</span>]
      min = middle - maxY1Frame / <span class="number">2</span>
      max = middle + maxY1Frame / <span class="number">2</span>

    <span class="property">@axes</span>().y1?.frame = [min, max]
    <span class="property">@y1</span>.domain([min, max])

  <span class="attribute">_calculateXRange</span>:<span class="function"> =&gt;</span>
    <span class="keyword">if</span> <span class="property">@_containsColumnChart</span>()
      renders = _.filter<span class="function"><span class="params">(<span class="property">@renderers</span>, (r) -&gt; r.name == <span class="string">'column'</span> <span class="keyword">or</span> r.name == <span class="string">'waterfall'</span>)</span>

      <span class="title">lastRange</span> = @<span class="title">width</span><span class="params">()</span>
      <span class="title">dR</span> = <span class="title">lastRange</span> / 2
      <span class="title">loop</span>
        @<span class="title">x</span>.<span class="title">range</span><span class="params">([<span class="number">0</span>, lastRange])</span>
        <span class="title">barWidth</span> = <span class="title">renders</span>[0].<span class="title">seriesWidth</span><span class="params">()</span>
        <span class="title">break</span> <span class="title">if</span> <span class="title">Math</span>.<span class="title">abs</span><span class="params">(<span class="property">@width</span>() - lastRange - barWidth)</span> &lt; 3
        <span class="title">if</span> @<span class="title">width</span><span class="params">()</span> - <span class="title">lastRange</span> - <span class="title">barWidth</span> &gt; 0
          <span class="title">lastRange</span> += <span class="title">dR</span>
        <span class="title">else</span>
          <span class="title">lastRange</span> -= <span class="title">dR</span>
        <span class="title">dR</span> = <span class="title">dR</span> / 2

      <span class="title">barWidth</span> = <span class="title">renders</span>[0].<span class="title">seriesWidth</span><span class="params">()</span> / 2
      <span class="title">rangeStart</span> = <span class="title">barWidth</span>
      <span class="title">rangeEnd</span> = @<span class="title">width</span><span class="params">()</span> - <span class="title">barWidth</span>

    @<span class="title">x</span>.<span class="title">range</span><span class="params">([rangeStart || <span class="number">0</span>, rangeEnd || <span class="property">@width</span>()])</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
