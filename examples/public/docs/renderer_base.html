<!DOCTYPE html>  <html> <head>   <title>renderer_base.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="renderer_base.html">                 renderer_base.coffee               </a>                                           <a class="source" href="tooltip.html">                 tooltip.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               renderer_base.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Tactile.RendererBase = </span><span class="k">class</span> <span class="nx">RendererBase</span>
  <span class="nv">defaults:</span>
    <span class="nv">cartesian: </span><span class="kc">true</span>
    <span class="nv">tension: </span><span class="mf">0.95</span>
    <span class="nv">strokeWidth: </span><span class="mi">3</span>
    <span class="nv">unstack: </span><span class="kc">true</span>
    <span class="nv">dotSize: </span><span class="mi">5</span>
    <span class="nv">opacity: </span><span class="mi">1</span>
    
    <span class="nv">stroke: </span><span class="kc">false</span>
    <span class="nv">fill: </span><span class="kc">false</span>

  <span class="nv">constructor: </span><span class="nf">(options = {}) -&gt;</span>
    <span class="vi">@graph = </span><span class="nx">options</span><span class="p">.</span><span class="nx">graph</span>
    <span class="vi">@tension = </span><span class="nx">options</span><span class="p">.</span><span class="nx">tension</span> <span class="o">or</span> <span class="nx">@tension</span>
    <span class="nx">@configure</span> <span class="nx">options</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>call constructor of inherited renderers</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@initialize</span><span class="o">?</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>

  <span class="nv">seriesPathFactory: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>implement in subclass</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">seriesStrokeFactory: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>implement in subclass</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">domain: </span><span class="o">-&gt;</span>
    <span class="nv">values = </span><span class="p">[]</span>
    <span class="nv">stackedData = </span><span class="nx">@graph</span><span class="p">.</span><span class="nx">stackedData</span> <span class="o">or</span> <span class="nx">@graph</span><span class="p">.</span><span class="nx">stackData</span><span class="p">()</span>
    <span class="nv">topSeriesData = </span><span class="p">(</span><span class="k">if</span> <span class="nx">@unstack</span> <span class="k">then</span> <span class="nx">stackedData</span> <span class="k">else</span> <span class="p">[</span><span class="nx">stackedData</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="nx">shift</span><span class="p">()])</span>
    <span class="nx">topSeriesData</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span><span class="nx">series</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">series</span><span class="p">.</span><span class="nx">forEach</span> <span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>if we don't stack data we don't want to sum up the values
as this causes the viewed window to be way to large
for example if you have x:1, y:20 and x1, y:10 y-axis will show up to y=30</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nx">@unstack</span>
          <span class="nx">values</span><span class="p">.</span><span class="nx">push</span> <span class="nx">d</span><span class="p">.</span><span class="nx">y</span>
        <span class="k">else</span>
          <span class="nx">values</span><span class="p">.</span><span class="nx">push</span> <span class="nx">d</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">d</span><span class="p">.</span><span class="nx">y0</span>
          
    <span class="nv">xMin = </span><span class="nx">stackedData</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="nx">x</span>
    <span class="nv">xMax = </span><span class="nx">stackedData</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="nx">stackedData</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="nx">x</span>
    <span class="nv">yMin = </span><span class="p">(</span><span class="k">if</span> <span class="nx">@graph</span><span class="p">.</span><span class="nx">min</span> <span class="o">is</span> <span class="s">&quot;auto&quot;</span> <span class="k">then</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">values</span><span class="p">)</span> <span class="k">else</span> <span class="nx">@graph</span><span class="p">.</span><span class="nx">min</span> <span class="o">or</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nv">yMax = </span><span class="nx">@graph</span><span class="p">.</span><span class="nx">max</span> <span class="o">or</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">values</span><span class="p">)</span>
    
    <span class="p">{</span> <span class="nv">x: </span><span class="p">[</span><span class="nx">xMin</span><span class="p">,</span> <span class="nx">xMax</span><span class="p">],</span> <span class="nv">y: </span><span class="p">[</span><span class="nx">yMin</span><span class="p">,</span> <span class="nx">yMax</span><span class="p">]</span> <span class="p">}</span>
    
    
  <span class="nv">render: </span><span class="o">=&gt;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">@series</span><span class="p">.</span><span class="nx">disabled</span><span class="p">)</span>
      <span class="vi">@timesRendered = </span><span class="mi">0</span>
      <span class="nv">line = </span><span class="nx">@seriesCanvas</span><span class="p">().</span><span class="nx">selectAll</span><span class="p">(</span><span class="s">&quot;path&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">data</span><span class="p">([</span><span class="nx">@series</span><span class="p">.</span><span class="nx">stack</span><span class="p">])</span>
      <span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
      <span class="k">return</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>drawing line by default</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">line = </span><span class="nx">@seriesCanvas</span><span class="p">().</span><span class="nx">selectAll</span><span class="p">(</span><span class="s">&quot;path&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">data</span><span class="p">([</span><span class="nx">@series</span><span class="p">.</span><span class="nx">stack</span><span class="p">])</span>
      
    <span class="nx">line</span><span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s">&quot;svg:path&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;clip-path&quot;</span><span class="p">,</span><span class="s">&quot;url(</span><span class="err">#</span><span class="s">clip)&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;fill&quot;</span><span class="p">,</span> <span class="p">(</span><span class="k">if</span> <span class="nx">@fill</span> <span class="k">then</span> <span class="nx">@series</span><span class="p">.</span><span class="nx">color</span> <span class="k">else</span> <span class="s">&quot;none&quot;</span><span class="p">))</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;stroke&quot;</span><span class="p">,</span> <span class="p">(</span><span class="k">if</span> <span class="nx">@stroke</span> <span class="k">then</span> <span class="nx">@series</span><span class="p">.</span><span class="nx">color</span> <span class="k">else</span> <span class="s">&quot;none&quot;</span><span class="p">))</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;stroke-width&quot;</span><span class="p">,</span> <span class="nx">@strokeWidth</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s">&#39;opacity&#39;</span><span class="p">,</span> <span class="nx">@opacity</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;class&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">@series</span><span class="p">.</span><span class="nx">className</span> <span class="o">or</span> <span class="s">&#39;&#39;</span><span class="si">}</span><span class="s"> </span><span class="si">#{</span><span class="k">if</span> <span class="nx">@series</span><span class="p">.</span><span class="nx">color</span> <span class="k">then</span> <span class="s">&#39;&#39;</span> <span class="k">else</span> <span class="s">&#39;colorless&#39;</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>

    <span class="nx">line</span><span class="p">.</span><span class="nx">transition</span><span class="p">().</span><span class="nx">duration</span><span class="p">(</span><span class="nx">@transitionSpeed</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s">&quot;d&quot;</span><span class="p">,</span> <span class="nx">@seriesPathFactory</span><span class="p">())</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Creates separate g element for each series. This gives us better control over each paths/rets/circles
for a particular series data. 
If we had all paths in a single node and want to do selectAll('path') to add new path you would modify
all the paths, not the only ones attached to the current series, which is very not desired.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">seriesCanvas: </span><span class="o">-&gt;</span>
    <span class="nx">@_seriesCanvas</span> <span class="o">||=</span> <span class="nx">@graph</span><span class="p">.</span><span class="nx">vis</span>
      <span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s">&quot;g</span><span class="err">#</span><span class="si">#{</span><span class="nx">@_nameToId</span><span class="p">()</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">data</span><span class="p">([</span><span class="nx">@series</span><span class="p">.</span><span class="nx">stack</span><span class="p">])</span>
      <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s">&quot;g&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="nx">@_nameToId</span><span class="p">())</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;class&#39;</span><span class="p">,</span> <span class="nx">@name</span><span class="p">)</span>
      
    <span class="nx">@_seriesCanvas</span>
    
  <span class="nv">configure: </span><span class="nf">(options) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>merge base defaults with particular renderer's</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">defaults = </span><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="p">{},</span> <span class="nx">@defaults</span><span class="p">,</span> <span class="nx">@specificDefaults</span> <span class="k">if</span> <span class="nx">@specificDefaults</span><span class="o">?</span>
    <span class="nv">options = </span><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="p">{},</span> <span class="nx">defaults</span><span class="p">,</span> <span class="nx">options</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">options</span><span class="p">,</span> <span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">@</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span>

  <span class="nv">_nameToId: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>TODO: handle empty name</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@series</span><span class="p">.</span><span class="nx">name</span><span class="o">?</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s+/g</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">()</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 