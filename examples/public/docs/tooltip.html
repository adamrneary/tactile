<!DOCTYPE html>

<html>
<head>
  <title>tooltip.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="renderer_base.html">
                renderer_base.coffee
              </a>
            
              
              <a class="source" href="tooltip.html">
                tooltip.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>tooltip.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>Copied from <a href="https://github.com/zmaril/d3-bootstrap-plugins">https://github.com/zmaril/d3-bootstrap-plugins</a></p>

            </div>
            
            <div class="content"><div class="highlight"><pre>window.Tactile = {} <span class="keyword">unless</span> window.Tactile
window.Tactile.Tooltip = <span class="class"><span class="keyword">class</span> <span class="title">Tooltip</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Tactile.Tooltip = class Tooltip</p>

            </div>
            
            <div class="content"><div class="highlight"><pre><span class="property">@_spotlightMode</span>: <span class="literal">false</span>

  <span class="property">@turnOffspotlight</span>: () -&gt;
    Tooltip._spotlightMode = <span class="literal">false</span>
    
  <span class="property">@spotlightOn</span>: (d) -&gt;
    Tooltip._spotlightMode = <span class="literal">true</span>
    
  <span class="property">@getSpotlight</span>: () -&gt;
    Tooltip._spotlightMode
  
  constructor: (<span class="property">@el</span>, <span class="property">@options</span>) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>console.log  @options, &#39;@options&#39;
console.log @el, &#39;@el&#39;</p>

            </div>
            
            <div class="content"><div class="highlight"><pre><span class="property">@el</span> = d3.select(<span class="property">@el</span>)
    <span class="property">@annotate</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>TODO: Done in a hurry. Dry this out.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>appendTooltip: -&gt;
    chartContainer = d3.select(<span class="property">@options</span>.graph._element)
    <span class="keyword">if</span> Tooltip._spotlightMode &amp;&amp; <span class="property">@el</span>.node().classList.contains(<span class="string">"active"</span>)
      tip = chartContainer.select(<span class="string">'.tooltip'</span>)
    <span class="keyword">else</span>
      chartContainer.selectAll(<span class="string">'.tooltip'</span>).remove()
      tip = chartContainer.append(<span class="string">'div'</span>)
        .classed(<span class="string">"tooltip"</span>, <span class="literal">true</span>)

      tip.append(<span class="string">'div'</span>)
        .html(<span class="property">@options</span>.text)
        .classed(<span class="string">"tooltip-inner"</span>, <span class="literal">true</span>)

    <span class="keyword">return</span> tip
    
  annotate: () -&gt;
    chartContainer = <span class="property">@el</span>.node().nearestViewportElement</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>tooltipCircleContainer is an element to which the circle will be appended
sets the parent node by default</p>

            </div>
            
            <div class="content"><div class="highlight"><pre><span class="keyword">if</span> <span class="property">@options</span>.tooltipCircleContainer
      <span class="property">@tooltipCircleContainer</span> = <span class="property">@options</span>.tooltipCircleContainer
    <span class="keyword">else</span> <span class="keyword">if</span> <span class="property">@options</span>.circleOnHover
      <span class="property">@tooltipCircleContainer</span> = <span class="property">@el</span>.node().parentNode

    <span class="function"><span class="title">moveTip</span></span> = (tip) =&gt;
      center = [<span class="number">0</span>,<span class="number">0</span>]
      <span class="keyword">if</span> <span class="property">@options</span>.placement <span class="keyword">is</span> <span class="string">"mouse"</span>
        center = d3.mouse(<span class="property">@options</span>.graph._element)
      <span class="keyword">else</span>
        <span class="keyword">if</span> <span class="property">@options</span>.position
          center[<span class="number">0</span>] = <span class="property">@options</span>.position[<span class="number">0</span>]
          center[<span class="number">1</span>] = <span class="property">@options</span>.position[<span class="number">1</span>]
        <span class="keyword">else</span>
          hoveredNode = <span class="property">@el</span>.node().getBBox()
          center[<span class="number">0</span>] = hoveredNode.x + hoveredNode.width / <span class="number">2</span>
          center[<span class="number">1</span>] = hoveredNode.y
          <span class="keyword">if</span> <span class="property">@options</span>.graph.series[<span class="number">0</span>].renderer <span class="keyword">is</span> <span class="string">"donut"</span>
            center[<span class="number">0</span>] = center[<span class="number">0</span>] + <span class="property">@options</span>.graph.series[<span class="number">0</span>].height-<span class="number">30</span>
            center[<span class="number">1</span>] = center[<span class="number">1</span>] + <span class="property">@options</span>.graph.series[<span class="number">0</span>].height-<span class="number">30</span>

        <span class="keyword">if</span> <span class="property">@el</span>.node().tagName == <span class="string">'circle'</span>
          center[<span class="number">1</span>] += (hoveredNode.height / <span class="number">2</span> - <span class="number">1</span>)

        center[<span class="number">0</span>] += <span class="property">@options</span>.graph.margin.left
        center[<span class="number">0</span>] += <span class="property">@options</span>.graph.padding.left

        center[<span class="number">1</span>] += <span class="property">@options</span>.graph.margin.top
        center[<span class="number">1</span>] += <span class="property">@options</span>.graph.padding.top

      <span class="keyword">if</span> <span class="property">@options</span>.displacement
        center[<span class="number">0</span>] += <span class="property">@options</span>.displacement[<span class="number">0</span>]
        center[<span class="number">1</span>] += <span class="property">@options</span>.displacement[<span class="number">1</span>]

      tip
        .style(<span class="string">"left"</span>,<span class="string">"<span class="subst">#{center[<span class="number">0</span>]}</span>px"</span>)
        .style(<span class="string">"top"</span>,<span class="string">"<span class="subst">#{center[<span class="number">1</span>]}</span>px"</span>)
        .style(<span class="string">"display"</span>,<span class="string">"block"</span>)

    <span class="property">@el</span>.<span class="literal">on</span>(<span class="string">"mouseover"</span>, () =&gt;
     <span class="keyword">if</span> Tooltip._spotlightMode
        <span class="keyword">return</span> <span class="keyword">unless</span> <span class="property">@el</span>.node().classList.contains(<span class="string">"active"</span>)
        
      tip = <span class="property">@appendTooltip</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>puts small circle on the hovered node</p>

            </div>
            
            <div class="content"><div class="highlight"><pre><span class="property">@_appendTipCircle</span>() <span class="keyword">if</span> <span class="property">@options</span>.circleOnHover

      tip.classed(<span class="string">"annotation"</span>, <span class="literal">true</span>)
        .classed(<span class="property">@options</span>.gravity, <span class="literal">true</span>)
        .style(<span class="string">"display"</span>,<span class="string">"none"</span>)

      tip.classed(<span class="string">'fade'</span>, <span class="literal">true</span>) <span class="keyword">if</span> <span class="property">@options</span>.fade

      tip.append(<span class="string">"div"</span>).attr(<span class="string">"class"</span>,<span class="string">"arrow"</span>)
      tip.select(<span class="string">'.tooltip-inner'</span>).html(<span class="property">@options</span>.text)
      inner = () -&gt; tip.classed(<span class="string">'in'</span>, <span class="literal">true</span>)

      setTimeout(inner,<span class="number">10</span>)
      
      tip.style(<span class="string">"display"</span>,<span class="string">""</span>)
      moveTip(tip)
    )

    mouseMove = () -&gt;
      d3.select(<span class="string">".annotation"</span>).call(moveTip.bind(@))
    
    <span class="keyword">if</span> <span class="property">@options</span>.mousemove
      <span class="property">@el</span>.<span class="literal">on</span>(<span class="string">"mousemove"</span>, mouseMove)

    <span class="property">@el</span>.<span class="literal">on</span>(<span class="string">"mouseout"</span>, () =&gt;
      <span class="keyword">return</span> <span class="keyword">if</span> Tooltip._spotlightMode <span class="comment"># don't hide the tooltip if spotlight</span>
      d3.select(<span class="property">@tooltipCircleContainer</span>).selectAll(<span class="string">"circle.tooltip-circle"</span>)
        .remove()</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>bring back the original style of a circle</p>

            </div>
            
            <div class="content"><div class="highlight"><pre><span class="keyword">if</span> <span class="property">@el</span>.node().tagName == <span class="string">'circle'</span>
        <span class="property">@el</span>.classed(<span class="string">'tip-hovered'</span>, <span class="literal">false</span>)
        <span class="property">@el</span>.attr(<span class="string">'stroke'</span>, <span class="property">@el</span>.attr(<span class="string">'data-stroke-color'</span>))
        <span class="property">@el</span>.attr(<span class="string">'fill'</span>, <span class="property">@el</span>.attr(<span class="string">'data-fill-color'</span>))
        
      tip = d3.selectAll(<span class="string">".annotation"</span>).classed(<span class="string">'in'</span>, <span class="literal">false</span>)
      remover = () -&gt; tip.remove()
      setTimeout(remover, <span class="number">150</span>)
    )
    
  _appendTipCircle: -&gt;
    hoveredNode = <span class="property">@el</span>.node().getBBox()</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>if element is a circle we would overwrite it&#39;s style
without appending another circle for tip</p>

            </div>
            
            <div class="content"><div class="highlight"><pre><span class="keyword">if</span> <span class="property">@el</span>.node().tagName == <span class="string">'circle'</span>
      <span class="property">@el</span>.attr(
        <span class="string">'data-stroke-color'</span>,
        <span class="property">@el</span>.attr(<span class="string">'stroke'</span>)) <span class="keyword">unless</span> <span class="property">@el</span>.attr(<span class="string">'data-stroke-color'</span>
      )
      <span class="property">@el</span>.attr(
        <span class="string">'data-fill-color'</span>,
        <span class="property">@el</span>.attr(<span class="string">'fill'</span>)) <span class="keyword">unless</span> <span class="property">@el</span>.attr(<span class="string">'data-fill-color'</span>
      )
      <span class="property">@el</span>.attr(<span class="string">'fill'</span>, <span class="property">@el</span>.attr(<span class="string">'data-stroke-color'</span>))
      <span class="property">@el</span>.attr(<span class="string">'stroke'</span>, <span class="property">@el</span>.attr(<span class="string">'data-fill-color'</span>))
    <span class="keyword">else</span>
      d3.select(<span class="property">@tooltipCircleContainer</span>)
        .append(<span class="string">"svg:circle"</span>)
        .attr(<span class="string">"cx"</span>, hoveredNode.x + hoveredNode.width / <span class="number">2</span>)
        .attr(<span class="string">"cy"</span>, hoveredNode.y)
        .attr(<span class="string">"r"</span>, <span class="number">4</span>)
        .attr(<span class="string">'class'</span>, <span class="string">'tooltip-circle'</span>)
        .attr(<span class="string">"stroke"</span>, <span class="property">@options</span>.circleColor || <span class="string">'orange'</span>)
        .attr(<span class="string">"fill"</span>, <span class="string">'white'</span>)
        .attr(<span class="string">"stroke-width"</span>, <span class="string">'1'</span>)

d3.selection.prototype.<span class="function"><span class="title">tooltip</span></span> = (f) -&gt;
  selection = @
  options = {}
  selection.each (d,i) -&gt;
    options = f.apply(@, arguments)
    <span class="keyword">new</span> Tactile.Tooltip(@, options)</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
