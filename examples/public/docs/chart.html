<!DOCTYPE html>

<html>
<head>
  <title>chart.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="chart.html">
                chart.coffee
              </a>
            
              
              <a class="source" href="index.html">
                index.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>chart.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>Tactile.Chart = <span class="class"><span class="keyword">class</span> <span class="title">Chart</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Hash to map renderer name to class name. Used in looking up series type</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _renderers:
    <span class="string">'gauge'</span>: GaugeRenderer
    <span class="string">'column'</span>: ColumnRenderer
    <span class="string">'line'</span>: LineRenderer
    <span class="string">'area'</span>: AreaRenderer
    <span class="string">'scatter'</span>: ScatterRenderer
    <span class="string">'donut'</span>: DonutRenderer</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>default values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  margin: {top: <span class="number">20</span>, right: <span class="number">20</span>, bottom: <span class="number">20</span>, left: <span class="number">20</span>}
  padding: {top: <span class="number">10</span>, right: <span class="number">10</span>, bottom: <span class="number">10</span>, left: <span class="number">10</span>}
  interpolation: <span class="string">'monotone'</span>
  offset: <span class="string">'zero'</span>
  min: <span class="literal">undefined</span>
  max: <span class="literal">undefined</span>
  transitionSpeed: <span class="number">200</span>
  defaultHeight: <span class="number">400</span>
  defaultWidth: <span class="number">730</span>
  defaultAxes:
    x:
      dimension: <span class="string">"time"</span>
      frame: [<span class="literal">undefined</span>, <span class="literal">undefined</span>]
    y:
      dimension: <span class="string">"linear"</span>
      frame: [<span class="literal">undefined</span>, <span class="literal">undefined</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>builds the chart object using any passed arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor: (args = {}) -&gt;
    <span class="property">@renderers</span> = []
    <span class="property">@series</span> = []
    <span class="property">@window</span> = {}
    <span class="property">@updateCallbacks</span> = []
    <span class="property">@_axes</span> = {}</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>chart size is handled with its own method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@setSize</span>
      width: args.width <span class="keyword">or</span> <span class="property">@defaultWidth</span>
      height: args.height <span class="keyword">or</span> <span class="property">@defaultHeight</span>
    <span class="keyword">delete</span> args.width <span class="keyword">if</span> args.width?
    <span class="keyword">delete</span> args.height <span class="keyword">if</span> args.height?</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>the remaining chart properties can be applied to the object directly</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each args, (val, key) =&gt;
      @[key] = val</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>add series if passed in the constructor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@addSeries</span>(args.series, overwrite: <span class="literal">true</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Adds series to the chart and creates renderer instance for it
Note: you may pass a single object here or an array of them
Note: pass option &#39;overwrite: true&#39; to remove all previous series</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  addSeries: (series, options = {overwrite: <span class="literal">false</span>}) -&gt;
    <span class="keyword">return</span> <span class="keyword">unless</span> series
    series = [series] <span class="keyword">unless</span> _.isArray(series)</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>TODO: Refactor this into series/renderer constructor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    seriesDefaults =
      dataTransform: (d) -&gt; d
    newSeries = _.map(series, (s) =&gt; _.extend({}, seriesDefaults, s))

    <span class="keyword">if</span> options.overwrite
      <span class="property">@series</span> = newSeries
    <span class="keyword">else</span>
      <span class="property">@series</span> = <span class="property">@series</span>.concat(newSeries)

    _.each newSeries, (s) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Add enable/disable/toggle serie functions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      s.disable = () -&gt;
        <span class="property">@disabled</span> = <span class="literal">true</span>

      s.enable = () -&gt;
        <span class="property">@disabled</span> = <span class="literal">false</span>

      s.toggle = () -&gt;
        <span class="property">@disabled</span> = <span class="keyword">not</span> <span class="property">@disabled</span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>only init the renderers for just added series
TODO: Refactor this into series/renderer constructor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@initRenderers</span>(newSeries)
    @

  initSeriesStackData: (options = {overwrite: <span class="literal">false</span>}) -&gt;
    <span class="keyword">return</span> <span class="keyword">if</span> <span class="property">@dataInitialized</span> <span class="keyword">and</span> <span class="keyword">not</span> options.overwrite</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>TODO: Refactor this into series/renderer constructor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@series</span>.<span class="function"><span class="title">active</span></span> = =&gt;
      <span class="property">@series</span>.filter (s) -&gt;
        <span class="keyword">not</span> s.disabled</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Initialize each serie&#39;s stack data
BEGIN</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    seriesData = <span class="property">@series</span>.map((d) =&gt;
      <span class="property">@_data</span>.map(d.dataTransform))

    layout = d3.layout.stack()
    layout.offset(<span class="property">@offset</span>)
    stackedData = layout(seriesData)

    i = <span class="number">0</span>
    <span class="property">@series</span>.forEach (series) -&gt;
      series.stack = stackedData[i++]</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>END</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    
    <span class="property">@dataInitialized</span> = <span class="literal">true</span>

  render: -&gt;
    <span class="keyword">if</span> <span class="property">@renderers</span> <span class="keyword">is</span> <span class="literal">undefined</span> <span class="keyword">or</span> _.isEmpty(<span class="property">@renderers</span>) <span class="keyword">or</span> <span class="property">@_allSeriesDisabled</span>()
      <span class="keyword">return</span>
    <span class="property">@initSeriesStackData</span>()
    <span class="property">@_setupCanvas</span>()
    stackedData = <span class="property">@stackData</span>()

    _.each <span class="property">@renderers</span>, (renderer) =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>discover domain for current renderer</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="property">@discoverRange</span>(renderer)
      renderer.render()

    <span class="property">@updateCallbacks</span>.forEach (callback) -&gt;
      callback()

  update: -&gt;
    <span class="property">@render</span>()

  discoverRange: (renderer) =&gt;
    domain = renderer.domain()
    <span class="keyword">if</span> renderer.cartesian</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>TODO: This needs way prettier implementation
It moves the range &#39;right&#39; by the value of half width of a bar
So if we have renderers including bar chart points are rendered in the
center of each bar and not a single bar is cut off by the chart border</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> <span class="property">@_containsColumnChart</span>()
        barWidth = <span class="property">@width</span>() / renderer.series.stack.length / <span class="number">2</span>
        rangeStart = barWidth
        rangeEnd = <span class="property">@width</span>() - barWidth

      xframe = [
        (<span class="keyword">if</span> <span class="property">@_axes</span>.x?.frame?[<span class="number">0</span>] <span class="keyword">then</span> <span class="property">@_axes</span>.x.frame[<span class="number">0</span>] <span class="keyword">else</span> domain.x[<span class="number">0</span>])
        (<span class="keyword">if</span> <span class="property">@_axes</span>.x?.frame?[<span class="number">1</span>] <span class="keyword">then</span> <span class="property">@_axes</span>.x.frame[<span class="number">1</span>] <span class="keyword">else</span> domain.x[<span class="number">1</span>])
      ]
      yframe = [
        (<span class="keyword">if</span> <span class="property">@_axes</span>.y?.frame?[<span class="number">0</span>] <span class="keyword">then</span> <span class="property">@_axes</span>.y.frame[<span class="number">0</span>] <span class="keyword">else</span> domain.y[<span class="number">0</span>])
        (<span class="keyword">if</span> <span class="property">@_axes</span>.y?.frame?[<span class="number">1</span>] <span class="keyword">then</span> <span class="property">@_axes</span>.y.frame[<span class="number">1</span>] <span class="keyword">else</span> domain.y[<span class="number">1</span>])
      ]

      <span class="property">@x</span> = d3.scale.linear()
        .domain(xframe)
        .range([rangeStart || <span class="number">0</span>, rangeEnd || <span class="property">@width</span>()])
      <span class="property">@y</span> = d3.scale.linear()
        .domain(yframe)
        .range([<span class="property">@height</span>(), <span class="number">0</span>])
      <span class="property">@y</span>.magnitude = d3.scale.linear()
        .domain([domain.y[<span class="number">0</span>] - domain.y[<span class="number">0</span>], domain.y[<span class="number">1</span>] - domain.y[<span class="number">0</span>]])
        .range([<span class="number">0</span>, <span class="property">@height</span>()])

  initAxis: (axis) -&gt;
    <span class="keyword">return</span> <span class="keyword">unless</span> <span class="property">@_allRenderersCartesian</span>()
    <span class="keyword">switch</span> axis.dimension
      <span class="keyword">when</span> <span class="string">"linear"</span>
        <span class="keyword">new</span> Tactile.AxisY(_.extend {}, axis.options, {graph: @})
      <span class="keyword">when</span> <span class="string">"time"</span>
        <span class="keyword">new</span> Tactile.AxisTime(_.extend {}, axis.options, {graph: @})
      <span class="keyword">else</span>
        console.log(<span class="string">"ERROR:<span class="subst">#{axis.dimension}</span> is not currently implemented"</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Used by range slider</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  dataDomain: -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>take from the first series</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    data = <span class="property">@renderers</span>[<span class="number">0</span>].series.stack
    [data[<span class="number">0</span>].x, data.slice(-<span class="number">1</span>).shift().x]

  stackData: -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Read more about stacking data here:
<a href="https://github.com/mbostock/d3/wiki/Stack-Layout">https://github.com/mbostock/d3/wiki/Stack-Layout</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    seriesData = <span class="property">@series</span>.active().map((d) =&gt; <span class="property">@_data</span>.map(d.dataTransform))

    layout = d3.layout.stack()
    layout.offset(<span class="property">@offset</span>)
    stackedData = layout(seriesData)

    <span class="property">@stackedData</span> = stackedData</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Set&#39;s the size for the chart
please note you have to call render() or update()
for this changes to be reflected in your chart</p>
<p>outerWith, outerHeight - no margins or paddings subtracted
marginedWidth, marginedHeight - margins subtracted
innerWidth, innerHeight - margins and paddings subtracted
width(), height() returns innerWidth as it&#39;s the most common used</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  setSize: (args = {}) -&gt;
    elWidth = $(<span class="property">@_element</span>).width()
    elHeight = $(<span class="property">@_element</span>).height()

    <span class="property">@outerWidth</span> = args.width || elWidth || <span class="property">@defaultWidth</span>
    <span class="property">@outerHeight</span> = args.height || elHeight || <span class="property">@defaultHeight</span>

    <span class="property">@marginedWidth</span> = <span class="property">@outerWidth</span> - <span class="property">@margin</span>.left - <span class="property">@margin</span>.right
    <span class="property">@marginedHeight</span> = <span class="property">@outerHeight</span> - <span class="property">@margin</span>.top - <span class="property">@margin</span>.bottom
    <span class="property">@innerWidth</span> = <span class="property">@marginedWidth</span> - <span class="property">@padding</span>.left - <span class="property">@padding</span>.right
    <span class="property">@innerHeight</span> = <span class="property">@marginedHeight</span> - <span class="property">@padding</span>.top - <span class="property">@padding</span>.bottom

    <span class="property">@vis</span>?.attr(<span class="string">'width'</span>, <span class="property">@innerWidth</span>).attr(<span class="string">'height'</span>, <span class="property">@innerHeight</span>)

  onUpdate: (callback) -&gt;
    <span class="property">@updateCallbacks</span>.push callback

  initRenderers: (series) -&gt;
    renderersSize = <span class="property">@renderers</span>.length
    _.each series, (s, index) =&gt;
      name = s.renderer
      <span class="keyword">throw</span> <span class="string">"couldn't find renderer <span class="subst">#{name}</span>"</span> <span class="keyword">if</span> (!<span class="property">@_renderers</span>[name])
      rendererClass = <span class="property">@_renderers</span>[name]
      rendererOptions = _.extend {},
        graph: @
        transitionSpeed: <span class="property">@transitionSpeed</span>
        series: s
        rendererIndex: index + renderersSize
      r = <span class="keyword">new</span> rendererClass(rendererOptions)
      <span class="property">@renderers</span>.push r

  renderersByType: (name) -&gt;
    <span class="property">@renderers</span>.filter((r) -&gt; r.name == name)

  stackTransition: -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Probably we&#39;ll want other types soon too</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each(<span class="property">@renderersByType</span>(<span class="string">'column'</span>), (r) -&gt; r.stackTransition())

  unstackTransition: -&gt;
    _.each(<span class="property">@renderersByType</span>(<span class="string">'column'</span>), (r) -&gt; r.unstackTransition())</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap for-h6">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <h6>#</h6>
<p>expose public variables</p>
<h6>#</h6>

            </div>
            
            <div class="content"><div class='highlight'><pre>  element: (val) -&gt;
    <span class="keyword">return</span> <span class="property">@_element</span> <span class="keyword">unless</span> val
    <span class="property">@_element</span> = val
    <span class="property">@_setupCanvas</span>()
    @

  height: (val) -&gt;
    <span class="keyword">return</span> (<span class="property">@innerHeight</span> <span class="keyword">or</span> <span class="property">@defaultHeight</span>) <span class="keyword">unless</span> val
    <span class="property">@setSize</span>(width: <span class="property">@outerWidth</span>, height: val)
    @

  width: (val) -&gt;
    <span class="keyword">return</span> (<span class="property">@innerWidth</span> <span class="keyword">or</span> <span class="property">@defaultWidth</span>) <span class="keyword">unless</span> val
    <span class="property">@setSize</span>(width: val, height: <span class="property">@outerHeight</span>)
    @

  data: (val) -&gt;
    <span class="keyword">return</span> <span class="property">@_data</span> <span class="keyword">unless</span> val
    <span class="property">@_data</span> = val
    <span class="property">@dataInitialized</span> = <span class="literal">false</span>
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>TODO:
it should be possible to pass options to the axes
so far they were
for x: unit, ticksTreatment, grid
for y: orientation, pixelsPerTick, ticks and few more.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  axes: (args, options) -&gt;
    <span class="keyword">return</span> <span class="property">@_axes</span> <span class="keyword">unless</span> args

    _.each [<span class="string">'x'</span>,<span class="string">'y'</span>], (k) =&gt;
      <span class="keyword">if</span> args[k]?
        <span class="property">@_axes</span>[k] =
          frame: (args[k]?.frame <span class="keyword">or</span> <span class="property">@defaultAxes</span>[k].frame)
          dimension: (args[k]?.dimension <span class="keyword">or</span> <span class="property">@defaultAxes</span>[k].dimension)
        <span class="property">@initAxis</span>(<span class="property">@_axes</span>[k])

    @</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap for-h6">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <h6>#</h6>
<p>private methods</p>
<h6>#</h6>
<p>Appends or updates all the chart canvas elements
so it respects the margins and paddings
done by following this example: <a href="http://bl.ocks.org/3019563">http://bl.ocks.org/3019563</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _setupCanvas: -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>need a constant class name for a containing div</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="property">@_element</span>).addClass(<span class="string">'graph-container'</span>)
    <span class="property">@svg</span> = <span class="property">@_findOrAppend</span>(what: <span class="string">'svg'</span>, <span class="keyword">in</span>: d3.select(<span class="property">@_element</span>))

    <span class="property">@svg</span>
      .attr(<span class="string">'width'</span>, <span class="property">@outerWidth</span>)
      .attr(<span class="string">'height'</span>, <span class="property">@outerHeight</span>)

    <span class="property">@vis</span> = <span class="property">@_findOrAppend</span>(what: <span class="string">'g'</span>, <span class="keyword">in</span>: <span class="property">@svg</span>)
      .attr(<span class="string">"transform"</span>, <span class="string">"translate(<span class="subst">#{@margin.left}</span>,<span class="subst">#{@margin.top}</span>)"</span>)

    <span class="property">@vis</span> = <span class="property">@_findOrAppend</span>(what: <span class="string">'g'</span>, <span class="keyword">in</span>: <span class="property">@vis</span>)
      .attr(<span class="string">"class"</span>, <span class="string">"outer-canvas"</span>)
      .attr(<span class="string">"width"</span>, <span class="property">@marginedWidth</span>)
      .attr(<span class="string">"height"</span>, <span class="property">@marginedHeight</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>this is the canvas on which all data should be drawn</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@vis</span> = <span class="property">@_findOrAppend</span>(what: <span class="string">'g'</span>, <span class="keyword">in</span>: <span class="property">@vis</span>)
      .attr(<span class="string">"transform"</span>, <span class="string">"translate(<span class="subst">#{@padding.left}</span>,<span class="subst">#{@padding.top}</span>)"</span>)
      .attr(<span class="string">"class"</span>, <span class="string">"inner-canvas"</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Add the default clip path.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    clip = <span class="property">@_findOrAppend</span>(what: <span class="string">'clipPath'</span>, selector: <span class="string">'#clip'</span>, <span class="keyword">in</span>: <span class="property">@vis</span>)
      .attr(<span class="string">"id"</span>, <span class="string">"clip"</span>)

    <span class="property">@_findOrAppend</span>(what: <span class="string">'rect'</span>, <span class="keyword">in</span>: clip)
      .attr(<span class="string">"width"</span>, <span class="property">@width</span>())</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>increase height to provide room vertically for line thickness</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      .attr(<span class="string">"height"</span>, <span class="property">@height</span>() + <span class="number">4</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>translate to adjust for increased height (split the difference)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      .attr(<span class="string">"transform"</span>, <span class="string">"translate(0,-2)"</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Add the clip path.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    scatterClip = <span class="property">@_findOrAppend</span>(what: <span class="string">'clipPath'</span>, selector: <span class="string">'#scatter-clip'</span>, <span class="keyword">in</span>: <span class="property">@vis</span>)
      .attr(<span class="string">"id"</span>, <span class="string">"scatter-clip"</span>)

    <span class="property">@_findOrAppend</span>(what: <span class="string">'rect'</span>, <span class="keyword">in</span>: scatterClip)</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>increase width to provide room vertically for circle radius</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      .attr(<span class="string">"width"</span>, <span class="property">@width</span>() + <span class="number">12</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>increase height to provide room vertically for circle radius</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      .attr(<span class="string">"height"</span>, <span class="property">@height</span>() + <span class="number">12</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>translate to adjust for increased width and height</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      .attr(<span class="string">"transform"</span>, <span class="string">"translate(-6,-6)"</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>looks for node in given node
returns it or appends to the node in <code>in</code> option
you can pass selector it is then used to lookup for the exisiting element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _findOrAppend: (options) -&gt;
    element = options.<span class="keyword">in</span>
    node = options.what
    selector = options.selector <span class="keyword">or</span> node

    found = element.select(selector)
    <span class="keyword">if</span> found?[<span class="number">0</span>][<span class="number">0</span>]
      found
    <span class="keyword">else</span>
      element.append(node)</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>this trims data down to the range that is currently viewed.
See range_slider for a clue how it&#39;s used</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _slice: (d) =&gt;
    <span class="keyword">return</span> <span class="literal">true</span> <span class="keyword">unless</span> <span class="property">@_allRenderersCartesian</span>()
    <span class="property">@timeframe</span>[<span class="number">0</span>] &lt;= d.x &lt;= <span class="property">@timeframe</span>[<span class="number">1</span>]

  _deg2rad: (deg) -&gt;
    deg * Math.PI / <span class="number">180</span>

  _hasDifferentRenderers: -&gt;
    _.uniq(_.map(<span class="property">@series</span>, (s) -&gt; s.renderer)).length &gt; <span class="number">1</span>

  _containsColumnChart: -&gt;
    _.any(<span class="property">@renderers</span>, (r) -&gt; r.name == <span class="string">'column'</span>)

  _allRenderersCartesian: -&gt;
    _.every(<span class="property">@renderers</span>, (r) -&gt; r.cartesian <span class="keyword">is</span> <span class="literal">true</span>)

  _allSeriesDisabled: -&gt;
    _.every(<span class="property">@series</span>, (s) -&gt; s.disabled <span class="keyword">is</span> <span class="literal">true</span>)</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
